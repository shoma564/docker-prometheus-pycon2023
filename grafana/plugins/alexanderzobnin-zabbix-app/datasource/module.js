define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","app/core/config","app/core/core","app/core/table_model","app/core/utils/datemath","app/core/utils/kbn","lodash","moment","react","react-dom"],((e,t,n,r,i,o,a,s,l,u,c,p,d)=>(()=>{var m={5295:(e,t,n)=>{"use strict";const r=n(7372),i=Symbol("max"),o=Symbol("length"),a=Symbol("lengthCalculator"),s=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),p=Symbol("lruList"),d=Symbol("cache"),m=Symbol("updateAgeOnGet"),h=()=>1,g=(e,t,n)=>{const r=e[d].get(t);if(r){const t=r.value;if(f(e,t)){if(y(e,r),!e[s])return}else n&&(e[m]&&(r.value.now=Date.now()),e[p].unshiftNode(r));return t.value}},f=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[l]&&n>e[l]},v=e=>{if(e[o]>e[i])for(let t=e[p].tail;e[o]>e[i]&&null!==t;){const n=t.prev;y(e,t),t=n}},y=(e,t)=>{if(t){const n=t.value;e[u]&&e[u](n.key,n.value),e[o]-=n.length,e[d].delete(n.key),e[p].removeNode(t)}};class b{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const E=(e,t,n,r)=>{let i=n.value;f(e,i)&&(y(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||h;if(this[a]="function"!=typeof t?h:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[m]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=h),e!==this[a]&&(this[a]=e,this[o]=0,this[p].forEach((e=>{e.length=this[a](e.value,e.key),this[o]+=e.length}))),v(this)}get lengthCalculator(){return this[a]}get length(){return this[o]}get itemCount(){return this[p].length}rforEach(e,t){t=t||this;for(let n=this[p].tail;null!==n;){const r=n.prev;E(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[p].head;null!==n;){const r=n.next;E(this,e,n,t),n=r}}keys(){return this[p].toArray().map((e=>e.key))}values(){return this[p].toArray().map((e=>e.value))}reset(){this[u]&&this[p]&&this[p].length&&this[p].forEach((e=>this[u](e.key,e.value))),this[d]=new Map,this[p]=new r,this[o]=0}dump(){return this[p].map((e=>!f(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[p]}set(e,t,n){if((n=n||this[l])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[a](t,e);if(this[d].has(e)){if(s>this[i])return y(this,this[d].get(e)),!1;const a=this[d].get(e).value;return this[u]&&(this[c]||this[u](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[o]+=s-a.length,a.length=s,this.get(e),v(this),!0}const m=new b(e,t,s,r,n);return m.length>this[i]?(this[u]&&this[u](e,t),!1):(this[o]+=m.length,this[p].unshift(m),this[d].set(e,this[p].head),v(this),!0)}has(e){if(!this[d].has(e))return!1;const t=this[d].get(e).value;return!f(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[p].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[d].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[d].forEach(((e,t)=>g(this,t,!1)))}}},3134:(e,t,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=o(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){const t=this.options.loose?a[s.COMPARATORLOOSE]:a[s.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new p(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new p(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=l(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=l(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||o&&a||s||u}}e.exports=i;const o=n(8716),{re:a,t:s}=n(9022),l=n(5452),u=n(6830),c=n(9510),p=n(7374)},7374:(e,t,n)=>{class r{constructor(e,t){if(t=o(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&g(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=i.get(t);if(n)return n;const r=this.options.loose,o=r?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];e=e.replace(o,P(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(u[c.COMPARATORTRIM],p),s("comparator trim",e,u[c.COMPARATORTRIM]),e=(e=(e=e.replace(u[c.TILDETRIM],d)).replace(u[c.CARETTRIM],m)).split(/\s+/).join(" ");const l=r?u[c.COMPARATORLOOSE]:u[c.COMPARATOR],g=e.split(" ").map((e=>v(e,this.options))).join(" ").split(/\s+/).map((e=>S(e,this.options))).filter(this.options.loose?e=>!!e.match(l):()=>!0).map((e=>new a(e,this.options))),f=(g.length,new Map);for(const e of g){if(h(e))return[e];f.set(e.value,e)}f.size>1&&f.has("")&&f.delete("");const y=[...f.values()];return i.set(t,y),y}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>f(n,t)&&e.set.some((e=>f(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(A(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const i=new(n(5295))({max:1e3}),o=n(8716),a=n(3134),s=n(6830),l=n(9510),{re:u,t:c,comparatorTrimReplace:p,tildeTrimReplace:d,caretTrimReplace:m}=n(9022),h=e=>"<0.0.0-0"===e.value,g=e=>""===e.value,f=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},v=(e,t)=>(s("comp",e,t),e=I(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=T(e,t),s("xrange",e),e=O(e,t),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>E(e,t))).join(" "),E=(e,t)=>{const n=t.loose?u[c.TILDELOOSE]:u[c.TILDE];return e.replace(n,((t,n,r,i,o)=>{let a;return s("tilde",e,t,n,r,i,o),y(n)?a="":y(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:y(i)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:o?(s("replaceTilde pr",o),a=`>=${n}.${r}.${i}-${o} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",a),a}))},I=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{s("caret",e,t);const n=t.loose?u[c.CARETLOOSE]:u[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,o,a)=>{let l;return s("caret",e,t,n,i,o,a),y(n)?l="":y(i)?l=`>=${n}.0.0${r} <${+n+1}.0.0-0`:y(o)?l="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:a?(s("replaceCaret pr",a),l="0"===n?"0"===i?`>=${n}.${i}.${o}-${a} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}-${a} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o}-${a} <${+n+1}.0.0-0`):(s("no pr"),l="0"===n?"0"===i?`>=${n}.${i}.${o}${r} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o} <${+n+1}.0.0-0`),s("caret return",l),l}))},T=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map((e=>x(e,t))).join(" ")),x=(e,t)=>{e=e.trim();const n=t.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return e.replace(n,((n,r,i,o,a,l)=>{s("xRange",e,n,r,i,o,a,l);const u=y(i),c=u||y(o),p=c||y(a),d=p;return"="===r&&d&&(r=""),l=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(o=0),a=0,">"===r?(r=">=",c?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):"<="===r&&(r="<",c?i=+i+1:o=+o+1),"<"===r&&(l="-0"),n=`${r+i}.${o}.${a}${l}`):c?n=`>=${i}.0.0${l} <${+i+1}.0.0-0`:p&&(n=`>=${i}.${o}.0${l} <${i}.${+o+1}.0-0`),s("xRange return",n),n}))},O=(e,t)=>(s("replaceStars",e,t),e.trim().replace(u[c.STAR],"")),S=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),P=e=>(t,n,r,i,o,a,s,l,u,c,p,d,m)=>`${n=y(r)?"":y(i)?`>=${r}.0.0${e?"-0":""}`:y(o)?`>=${r}.${i}.0${e?"-0":""}`:a?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=y(u)?"":y(c)?`<${+u+1}.0.0-0`:y(p)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${p}-${d}`:e?`<${u}.${c}.${+p+1}-0`:`<=${l}`}`.trim(),A=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==a.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},9510:(e,t,n)=>{const r=n(6830),{MAX_LENGTH:i,MAX_SAFE_INTEGER:o}=n(39),{re:a,t:s}=n(9022),l=n(8716),{compareIdentifiers:u}=n(8822);class c{constructor(e,t){if(t=l(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?a[s.LOOSE]:a[s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=c},6457:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},5452:(e,t,n)=>{const r=n(8565),i=n(3328),o=n(2260),a=n(6579),s=n(290),l=n(5891);e.exports=(e,t,n,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,u);case"!=":return i(e,n,u);case">":return o(e,n,u);case">=":return a(e,n,u);case"<":return s(e,n,u);case"<=":return l(e,n,u);default:throw new TypeError(`Invalid operator: ${t}`)}}},9469:(e,t,n)=>{const r=n(9510),i=n(5692),{re:o,t:a}=n(9022);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=o[a.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),o[a.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;o[a.COERCERTL].lastIndex=-1}else n=e.match(o[a.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},1868:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>{const i=new r(e,n),o=new r(t,n);return i.compare(o)||i.compareBuild(o)}},5919:(e,t,n)=>{const r=n(3992);e.exports=(e,t)=>r(e,t,!0)},3992:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},1007:(e,t,n)=>{const r=n(5692),i=n(8565);e.exports=(e,t)=>{if(i(e,t))return null;{const n=r(e),i=r(t),o=n.prerelease.length||i.prerelease.length,a=o?"pre":"",s=o?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==i[e])return a+e;return s}}},8565:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0===r(e,t,n)},2260:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>0},6579:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>=0},515:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(e){return null}}},290:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<0},5891:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<=0},2611:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).major},6319:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).minor},3328:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0!==r(e,t,n)},5692:(e,t,n)=>{const{MAX_LENGTH:r}=n(39),{re:i,t:o}=n(9022),a=n(9510),s=n(8716);e.exports=(e,t)=>{if(t=s(t),e instanceof a)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?i[o.LOOSE]:i[o.FULL]).test(e))return null;try{return new a(e,t)}catch(e){return null}}},7368:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).patch},7794:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},9114:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(t,e,n)},3843:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(n,e,t)))},9845:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},8753:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(e,n,t)))},398:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},8873:(e,t,n)=>{const r=n(9022);e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(39).SEMVER_SPEC_VERSION,SemVer:n(9510),compareIdentifiers:n(8822).compareIdentifiers,rcompareIdentifiers:n(8822).rcompareIdentifiers,parse:n(5692),valid:n(398),clean:n(6457),inc:n(515),diff:n(1007),major:n(2611),minor:n(6319),patch:n(7368),prerelease:n(7794),compare:n(3992),rcompare:n(9114),compareLoose:n(5919),compareBuild:n(1868),sort:n(8753),rsort:n(3843),gt:n(2260),lt:n(290),eq:n(8565),neq:n(3328),gte:n(6579),lte:n(5891),cmp:n(5452),coerce:n(9469),Comparator:n(3134),Range:n(7374),satisfies:n(9845),toComparators:n(8384),maxSatisfying:n(6369),minSatisfying:n(2663),minVersion:n(75),validRange:n(9178),outside:n(9434),gtr:n(8237),ltr:n(9860),intersects:n(8258),simplifyRange:n(3607),subset:n(2199)}},39:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},6830:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},8822:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),i=t.test(n);return r&&i&&(e=+e,n=+n),e===n?0:r&&!i?-1:i&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},8716:e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},9022:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r}=n(39),i=n(6830),o=(t=e.exports={}).re=[],a=t.src=[],s=t.t={};let l=0;const u=(e,t,n)=>{const r=l++;i(r,t),s[e]=r,a[r]=t,o[r]=new RegExp(t,n?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${a[s.NUMERICIDENTIFIER]})\\.(${a[s.NUMERICIDENTIFIER]})\\.(${a[s.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${a[s.NUMERICIDENTIFIERLOOSE]})\\.(${a[s.NUMERICIDENTIFIERLOOSE]})\\.(${a[s.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${a[s.NUMERICIDENTIFIER]}|${a[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${a[s.NUMERICIDENTIFIERLOOSE]}|${a[s.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${a[s.PRERELEASEIDENTIFIER]}(?:\\.${a[s.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${a[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[s.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${a[s.BUILDIDENTIFIER]}(?:\\.${a[s.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${a[s.MAINVERSION]}${a[s.PRERELEASE]}?${a[s.BUILD]}?`),u("FULL",`^${a[s.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${a[s.MAINVERSIONLOOSE]}${a[s.PRERELEASELOOSE]}?${a[s.BUILD]}?`),u("LOOSE",`^${a[s.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",`${a[s.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),u("XRANGEIDENTIFIER",`${a[s.NUMERICIDENTIFIER]}|x|X|\\*`),u("XRANGEPLAIN",`[v=\\s]*(${a[s.XRANGEIDENTIFIER]})(?:\\.(${a[s.XRANGEIDENTIFIER]})(?:\\.(${a[s.XRANGEIDENTIFIER]})(?:${a[s.PRERELEASE]})?${a[s.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${a[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[s.XRANGEIDENTIFIERLOOSE]})(?:${a[s.PRERELEASELOOSE]})?${a[s.BUILD]}?)?)?`),u("XRANGE",`^${a[s.GTLT]}\\s*${a[s.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${a[s.GTLT]}\\s*${a[s.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),u("COERCERTL",a[s.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${a[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${a[s.LONETILDE]}${a[s.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${a[s.LONETILDE]}${a[s.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${a[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${a[s.LONECARET]}${a[s.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${a[s.LONECARET]}${a[s.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${a[s.GTLT]}\\s*(${a[s.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${a[s.GTLT]}\\s*(${a[s.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${a[s.GTLT]}\\s*(${a[s.LOOSEPLAIN]}|${a[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${a[s.XRANGEPLAIN]})\\s+-\\s+(${a[s.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${a[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[s.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},8237:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,">",n)},8258:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t))},9860:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,"<",n)},6369:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let o=null,a=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&-1!==a.compare(e)||(o=e,a=new r(o,n)))})),o}},2663:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let o=null,a=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&1!==a.compare(e)||(o=e,a=new r(o,n)))})),o}},75:(e,t,n)=>{const r=n(9510),i=n(7374),o=n(2260);e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let a=null;i.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":a&&!o(t,a)||(a=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!a||n&&!o(n,a)||(n=a)}return n&&e.test(n)?n:null}},9434:(e,t,n)=>{const r=n(9510),i=n(3134),{ANY:o}=i,a=n(7374),s=n(9845),l=n(2260),u=n(290),c=n(5891),p=n(6579);e.exports=(e,t,n,d)=>{let m,h,g,f,v;switch(e=new r(e,d),t=new a(t,d),n){case">":m=l,h=c,g=u,f=">",v=">=";break;case"<":m=u,h=p,g=l,f="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,d))return!1;for(let n=0;n<t.set.length;++n){const r=t.set[n];let a=null,s=null;if(r.forEach((e=>{e.semver===o&&(e=new i(">=0.0.0")),a=a||e,s=s||e,m(e.semver,a.semver,d)?a=e:g(e.semver,s.semver,d)&&(s=e)})),a.operator===f||a.operator===v)return!1;if((!s.operator||s.operator===f)&&h(e,s.semver))return!1;if(s.operator===v&&g(e,s.semver))return!1}return!0}},3607:(e,t,n)=>{const r=n(9845),i=n(3992);e.exports=(e,t,n)=>{const o=[];let a=null,s=null;const l=e.sort(((e,t)=>i(e,t,n)));for(const e of l)r(e,t,n)?(s=e,a||(a=e)):(s&&o.push([a,s]),s=null,a=null);a&&o.push([a,null]);const u=[];for(const[e,t]of o)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");const c=u.join(" || "),p="string"==typeof t.raw?t.raw:String(t);return c.length<p.length?c:t}},2199:(e,t,n)=>{const r=n(7374),{ANY:i}=n(3134),o=n(9845),a=n(3992),s=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i)return 1===t.length&&t[0].semver===i;const r=new Set;let s,c,p,d,m,h,g;for(const t of e)">"===t.operator||">="===t.operator?s=l(s,t,n):"<"===t.operator||"<="===t.operator?c=u(c,t,n):r.add(t.semver);if(r.size>1)return null;if(s&&c){if(p=a(s.semver,c.semver,n),p>0)return null;if(0===p&&(">="!==s.operator||"<="!==c.operator))return null}for(const e of r){if(s&&!o(e,String(s),n))return null;if(c&&!o(e,String(c),n))return null;for(const r of t)if(!o(e,String(r),n))return!1;return!0}for(const e of t){if(g=g||">"===e.operator||">="===e.operator,h=h||"<"===e.operator||"<="===e.operator,s)if(">"===e.operator||">="===e.operator){if(d=l(s,e,n),d===e&&d!==s)return!1}else if(">="===s.operator&&!o(s.semver,String(e),n))return!1;if(c)if("<"===e.operator||"<="===e.operator){if(m=u(c,e,n),m===e&&m!==c)return!1}else if("<="===c.operator&&!o(c.semver,String(e),n))return!1;if(!e.operator&&(c||s)&&0!==p)return!1}return!(s&&h&&!c&&0!==p||c&&g&&!s&&0!==p)},l=(e,t,n)=>{if(!e)return t;const r=a(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},u=(e,t,n)=>{if(!e)return t;const r=a(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n)=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=s(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},8384:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},9178:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},9976:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},7372:(e,t,n)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,n,r){if(!(this instanceof a))return new a(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)n.push(o.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;var o,s,l,u,c=[];for(r=0;i&&r<t;r++)c.push(i.value),i=this.removeNode(i);for(null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev),r=0;r<n.length;r++)o=this,s=i,l=n[r],u=void 0,null===(u=s===o.head?new a(l,null,s,o):new a(l,s,s.next,o)).next&&(o.tail=u),null===u.prev&&(o.head=u),o.length++,i=u;return c},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(9976)(r)}catch(e){}},7644:t=>{"use strict";t.exports=e},3305:e=>{"use strict";e.exports=t},3545:e=>{"use strict";e.exports=n},7388:e=>{"use strict";e.exports=r},346:e=>{"use strict";e.exports=i},7294:e=>{"use strict";e.exports=o},4745:e=>{"use strict";e.exports=a},7084:e=>{"use strict";e.exports=s},7399:e=>{"use strict";e.exports=l},5980:e=>{"use strict";e.exports=u},8283:e=>{"use strict";e.exports=c},2650:e=>{"use strict";e.exports=p},2729:e=>{"use strict";e.exports=d}},h={};function g(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={exports:{}};return m[e](n,n.exports,g),n.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return(()=>{"use strict";g.r(f),g.d(f,{plugin:()=>Br});var e=g(3305),t=g(5980),n=g.n(t),r=g(346),i=g.n(r),o=g(7294),a=g(7084),s=g(8283),l=g.n(s);const u="0",c="1",p="2",d="3",m="4",h="5",v="6",y=[{val:0,text:"Not classified"},{val:1,text:"Information"},{val:2,text:"Warning"},{val:3,text:"Average"},{val:4,text:"High"},{val:5,text:"Disaster"}],b="range_series";var E,I,w,T;!function(e){e.Group="group",e.Host="host",e.Application="application",e.Macro="macro",e.ItemTag="itemTag",e.Item="item",e.ItemValues="itemValues"}(E||(E={})),function(e){e.Problems="problems",e.Recent="recent",e.History="history"}(I||(I={}));class x extends e.BusEventWithPayload{}function O(e){return n().forEach(e,(e=>(e.item=e.name,e.name=function(e,t){const r=function(e){const t=[];let r=!1,i=!1,o="";return n().forEach(e,(e=>{'"'===e&&i?o+=e:'"'===e&&r?r=!1:'"'!==e||r?"["!==e||r?"]"!==e||r?","!==e||r||i?o+=e:(t.push(o),o=""):i=!1:i=!0:r=!0})),t.push(o),t}(t.substring(t.indexOf("[")+1,t.lastIndexOf("]")));for(let t=r.length;t>=1;t--)e=e.replace("$"+t,r[t-1]);return e}(e.item,e.key_),e))),e}x.type="zbx-query-updated",function(e){e.UserLogin="userLogin",e.Token="token"}(w||(w={})),function(e){e.AndOr="0",e.Or="2"}(T||(T={}));const S=/{\$[A-Z0-9_\.]+}/g;function P(e,t,r){let i=r?e.url:e.name;const o=i.match(S);return n().forEach(o,(o=>{const a=n().filter(t,(t=>{if(t.hostid){if(r){let r=!1;return n().forEach(e.hosts,(e=>{e.hostid===t.hostid&&(r=!0)})),r}return t.hostid===e.hostid}return!0})),s=n().find(a,{macro:o});if(s&&s.value){const e=s.value,t=new RegExp(function(e){return e.replace(/\$/,"\\$")}(o));i=i.replace(t,e)}})),i}function A(e){let t;const r=[];n().each(function(e){const t=/\{[^\{\}]*\}|\{\/.*\/\}/g;let r;if(function(e){return/^\{.+\}$/.test(e)}(e)){const i=e.match(t);r=n().map(i,(e=>n().trim(e,"{}")))}else r=e.split(".");return r}(e),(e=>{"*"===e&&(e="/.*/"),r.push(e)}));const i=n().zipObject(["group","host","app","item"],r);switch(4===r.length&&"/.*/"===i.app&&(i.app=""),r.length){case 1:t=E.Group;break;case 2:t=E.Host;break;case 3:t=E.Application;break;case 4:t=E.Item}return{queryType:t,group:i.group||"",host:i.host||"",application:i.app||"",item:i.item||""}}const D=/^\/(.*)\/([gmi]*)$/m;function C(e){return D.test(e)}function R(t){const n=t.to.diff(t.from),r=Math.round(n/1e3),i=e.rangeUtil.secondsToHms(n/1e3);return{__range_ms:{text:n,value:n},__range_s:{text:r,value:r},__range:{text:i,value:i},__range_series:{text:b,value:b}}}function F(e){const t=e.match(D),n=t[1],r=""!==t[2]?t[2]:void 0;return new RegExp(n,r)}function $(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}function j(e){const t=function(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)?/g.exec(e);return!t||!e||t.length>2&&!t[2]?"":t[1]+(t.length>2?t[2]:"s")}(e);return t?N(t):0}function N(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)/g.exec(e);return l().duration(Number(t[1]),t[2]).valueOf()}function k(e){return function(t){for(let n=0;n<e.length;n++)t=e[n].call(this,t);return t}}function L(e){return e.replace(/\s+/g," ").trim()}function _(e){if(!e)return[];let t=n().map(e.split(","),(e=>e.trim()));return t=n().map(t,(e=>{var t,n;const r=e.split(":");return{tag:null===(t=r[0])||void 0===t?void 0:t.trim(),value:null===(n=r[1])||void 0===n?void 0:n.trim()}})),t}function M(e){const t={tag:"",value:""},n=e.indexOf(":");return n>0?(t.tag=e.slice(0,n).trim(),t.value=e.slice(Math.min(n+1,e.length)).trim()):t.tag=e.trim(),t}function V(e){return e.value?`${e.tag}: ${e.value}`:e.tag}function q(e){return e||[]}const B={"%":"percent",b:"decbits",bps:"bps",B:"bytes",Bps:"binBps",uptime:"dtdhms",qps:"qps",iops:"iops",Hz:"hertz",V:"volt",C:"celsius",RPM:"rotrpm",dBm:"dBm"},H=(()=>{const t={},n=(0,e.getValueFormats)();for(const e of n)for(const n of e.submenu){const e=n.value;t[e]=e}return t})();function z(e){let t=B[e];return t||(t=H[e]),t}function W(e,t,n){if(null===e||e.length<2||n>e.length-1||n<0||t>e.length-1||t<0)return e;const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=i===t?e[n]:i===n?e[t]:e[i];return r}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){G(e,t,n[t])}))}return e}function Q(e){return e.resultFormat=e.resultFormat||"time_series",function(e){return!(e.mode&&0!==e.mode&&2!==e.mode||!(e.hostFilter||e.itemFilter||e.downsampleFunction||e.host&&e.host.host)||void 0!==e.item.filter||void 0!==e.host.filter)}(e=function(e){return e.group&&Array.isArray(e.group)&&(e.group={filter:""}),e}(e))?function(e){return e.group.filter="*"===e.group.name?"/.*/":e.group.name,e.host.filter="*"===e.host.name?X(e.hostFilter):e.host.name,e.application.filter="*"===e.application.name?"":e.application.name,e.item.filter="All"===e.item.name?X(e.itemFilter):e.item.name,e.macro.filter="*"===e.macro.macro?X(e.macroFilter):e.macro.macro,e}(e):(function(e){if(e.functions)for(const t of e.functions)t.def&&"percentil"===t.def.name&&(t.def.name="percentile")}(e),function(e){var t;void 0===e.queryType&&("Metrics"===e.mode?e.queryType=u:void 0!==e.mode&&(e.queryType=e.mode,delete e.mode)),"number"==typeof e.queryType&&(e.queryType=null===(t=e.queryType)||void 0===t?void 0:t.toString())}(e),function(e){e.queryType!==c||e.slaInterval||(e.slaInterval="none")}(e),function(e){var t;"priority"===(null===(t=e.options)||void 0===t?void 0:t.sortProblems)&&(e.options.sortProblems="severity")}(e),function(e){var t,n;e.itemTag||(e.itemTag={filter:""},(null===(t=e.application)||void 0===t?void 0:t.filter)&&(e.itemTag.filter=`Application: ${null===(n=e.application)||void 0===n?void 0:n.filter}`))}(e),function(e){var t,n;(null===(t=e.slaProperty)||void 0===t?void 0:t.property)&&(e.slaProperty=null===(n=e.slaProperty)||void 0===n?void 0:n.property)}(e),function(e){var t,n,r,i;(null===(t=e.triggers)||void 0===t?void 0:t.minSeverity)&&(e.options.minSeverity=null===(r=e.triggers)||void 0===r?void 0:r.minSeverity,delete e.triggers.minSeverity),(null===(n=e.triggers)||void 0===n?void 0:n.count)&&(e.options.count=null===(i=e.triggers)||void 0===i?void 0:i.count,delete e.triggers.count)}(e),function(e){e.schema>=11||("6"===e.queryType?(e.queryType=m,e.countTriggersBy="items"):"7"===e.queryType?(e.queryType=m,e.countTriggersBy="problems"):"8"===e.queryType&&(e.queryType=v))}(e),function(e){var t;e.schema>=12||(null==e||null===(t=e.options)||void 0===t?void 0:t.minSeverity)&&(e.options.severities=[0,1,2,3,4,5].filter((t=>t>=e.options.minSeverity)))}(e),e.schema=12,e)}function X(e){return e?"/"+e+"/":"/.*/"}const Z=e=>{var t;const n=(e=>{var t,n,r,i,o,a,s,l;return{group:{filter:null!==(t=e.group)&&void 0!==t?t:""},host:{filter:null!==(n=e.host)&&void 0!==n?n:""},application:{filter:null!==(r=e.application)&&void 0!==r?r:""},trigger:{filter:null!==(i=e.trigger)&&void 0!==i?i:""},options:{minSeverity:null!==(o=e.minseverity)&&void 0!==o?o:0,showOkEvents:null!==(a=e.showOkEvents)&&void 0!==a&&a,hideAcknowledged:null!==(s=e.hideAcknowledged)&&void 0!==s&&s,showHostname:null!==(l=e.showHostname)&&void 0!==l&&l}}})(e);return e.target=(r=U({},n,e.target),i=null!=(i={fromAnnotations:!0,options:U({},n.options,null===(t=e.target)||void 0===t?void 0:t.options)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(i)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})),r),e;var r,i},Y={},J={Transform:[],Aggregate:[],Filter:[],Trends:[],Time:[],Alias:[],Special:[]};function K(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],e.category&&J[e.category].push(e),Y[e.name]=e,Y[e.shortName||e.name]=e}K({name:"groupBy",category:"Transform",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),K({name:"scale",category:"Transform",params:[{name:"factor",type:"float",options:[100,.01,10,-1]}],defaultParams:[100]}),K({name:"offset",category:"Transform",params:[{name:"delta",type:"float",options:[-100,100]}],defaultParams:[100]}),K({name:"delta",category:"Transform",params:[],defaultParams:[]}),K({name:"rate",category:"Transform",params:[],defaultParams:[]}),K({name:"movingAverage",category:"Transform",params:[{name:"factor",type:"int",options:[6,10,60,100,600]}],defaultParams:[10]}),K({name:"exponentialMovingAverage",category:"Transform",params:[{name:"smoothing",type:"float",options:[6,10,60,100,600]}],defaultParams:[.2]}),K({name:"percentile",category:"Transform",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),K({name:"removeAboveValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),K({name:"removeBelowValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),K({name:"transformNull",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),K({name:"aggregateBy",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),K({name:"sumSeries",category:"Aggregate",params:[],defaultParams:[]}),K({name:"percentileAgg",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),K({name:"top",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),K({name:"bottom",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),K({name:"sortSeries",category:"Filter",params:[{name:"direction",type:"string",options:["asc","desc"]}],defaultParams:["asc"]}),K({name:"trendValue",category:"Trends",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),K({name:"timeShift",category:"Time",params:[{name:"interval",type:"string",options:["24h","7d","1M","+24h","-24h"]}],defaultParams:["24h"]}),K({name:"setAlias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:[]}),K({name:"setAliasByRegex",category:"Alias",params:[{name:"aliasByRegex",type:"string"}],defaultParams:[]}),K({name:"replaceAlias",category:"Alias",params:[{name:"regexp",type:"string"},{name:"newAlias",type:"string"}],defaultParams:["/(.*)/","$1"]}),K({name:"consolidateBy",category:"Special",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),n().each(J,((e,t)=>{J[t]=n().sortBy(e,"name")}));class ee{bindFunction(e){const t=e[this.def.name];if(t){let e,r=t;for(let t=0;t<this.params.length;t++)e=this.params[t],"int"!==this.def.params[t].type&&"float"!==this.def.params[t].type||(e=Number(e)),r=n().partial(r,e);return r}throw{message:"Method not found "+this.def.name}}render(e){const t=this.def.name+"(",r=n().map(this.params,((e,t)=>{const n=this.def.params[t].type;return"int"===n||"float"===n||"value_or_series"===n||"boolean"===n||"int_or_interval"===n&&(r=e,!isNaN(parseFloat(r))&&isFinite(r))?e:"'"+e+"'";var r}));return e&&r.unshift(e),t+r.join(", ")+")"}_hasMultipleParamsInString(e,t){return-1!==e.indexOf(",")&&this.def.params[t+1]&&this.def.params[t+1].optional}updateParam(e,t){this._hasMultipleParamsInString(e,t)?n().each(e.split(","),((e,t)=>{this.updateParam(e.trim(),t)})):(""===e&&this.def.params[t].optional?this.params.splice(t,1):this.params[t]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}constructor(e,t){this.def=e,t?this.params=t:(this.params=[],this.params=e.defaultParams.slice(0)),this.updateText()}}function te(e,t){if(n().isString(e)){if(!Y[e])throw{message:"Method not found "+name};e=Y[e]}return new ee(e,t)}function ne(){return J}var re=g(3545);function ie(e,t){return new RegExp(t).exec(e)[0]}const oe={timeShift:function(e,t){const r=function(e){const t=/^([\+\-]*)([\d]+)(y|M|w|d|h|m|s)/g.exec(e);let n=0;return n="+"===t[1]?0-l().duration(Number(t[2]),t[3]).valueOf():l().duration(Number(t[2]),t[3]).valueOf(),n}(e)/1e3;return n().map(t,(e=>e-r))},setAlias:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){var i,o;const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var a,s;return(null==r||null===(i=r.config)||void 0===i||null===(o=i.custom)||void 0===o?void 0:o.scopedVars)&&(t=(0,re.getTemplateSrv)().replace(t,null==r||null===(a=r.config)||void 0===a||null===(s=a.custom)||void 0===s?void 0:s.scopedVars)),r&&(r.config.displayNameFromDS=t),n.name=t,n}for(let r=0;r<n.fields.length;r++){const i=n.fields[r];var l,u,c,p;if(i.type!==e.FieldType.time)(null==i||null===(l=i.config)||void 0===l||null===(u=l.custom)||void 0===u?void 0:u.scopedVars)&&(t=(0,re.getTemplateSrv)().replace(t,null==i||null===(c=i.config)||void 0===c||null===(p=c.custom)||void 0===p?void 0:p.scopedVars)),i.config.displayNameFromDS=t}return n},setAliasByRegex:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));try{var i;r&&(r.config.displayNameFromDS=ie(null===(i=r.config)||void 0===i?void 0:i.displayNameFromDS,t)),n.name=ie(n.name,t)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}return n}for(const r of n.fields)if(r.type!==e.FieldType.time)try{var o;r.config.displayNameFromDS=ie(null===(o=r.config)||void 0===o?void 0:o.displayNameFromDS,t)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}return n},replaceAlias:function(t,n,r){var i;let o;if(o=C(t)?F(t):t,(null===(i=r.fields)||void 0===i?void 0:i.length)<=2){var a;let t=r.name.replace(o,n);const i=r.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var s;return(null==i||null===(a=i.state)||void 0===a?void 0:a.scopedVars)&&(t=(0,re.getTemplateSrv)().replace(t,null==i||null===(s=i.state)||void 0===s?void 0:s.scopedVars)),i&&(i.config.displayNameFromDS=t),r.name=t,r}for(const t of r.fields)if(t.type!==e.FieldType.time){var l,u,c;let e=null===(l=t.config)||void 0===l||null===(u=l.displayNameFromDS)||void 0===u?void 0:u.replace(o,n);var p;(null==t||null===(c=t.state)||void 0===c?void 0:c.scopedVars)&&e&&(e=(0,re.getTemplateSrv)().replace(e,null==t||null===(p=t.state)||void 0===p?void 0:p.scopedVars)),t.name=e||t.name}return r}},ae={get metricFunctions(){return oe}};var se=g(4745),le=g.n(se);function ue(e,t,r,i){const o=n().groupBy(e,"itemid"),a=n().uniqBy(n().flatten(n().map(t,"hosts")),"hostid");return n().map(o,((e,o)=>{const s=n().find(t,{itemid:o});let l=s.name;const u={__zbx_item:{value:s.name},__zbx_item_name:{value:s.name},__zbx_item_key:{value:s.key_},__zbx_item_interval:{value:s.delay}};if(n().keys(a).length>0){const e=n().find(a,{hostid:s.hostid});u.__zbx_host={value:e.host},u.__zbx_host_name={value:e.name},n().keys(a).length>1&&r&&(l=e.name+": "+l)}return{target:l,datapoints:n().map(e,i),scopedVars:u,item:s}}))}function ce(e,t){let n=t.value;return e.textFilter&&(n=pe(t.value,e.textFilter,e.useCaptureGroups)),[n,1e3*t.clock+Math.round(t.ns/1e6)]}function pe(e,t,n){const r=new RegExp(t).exec(e);return r?n?r[1]:r[0]:""}function de(e){switch(e){case"sla":return"sli";case"okTime":return"uptime";case"downtimeTime":return"downtime";default:return e}}function me(e){return[Number(e.value),1e3*e.clock+Math.round(e.ns/1e6)]}function he(e,t){let n;switch(e){case"min":n=t.value_min;break;case"max":n=t.value_max;break;case"avg":default:n=t.value_avg;break;case"sum":n=t.value_avg*t.num;break;case"count":n=t.num}return[Number(n),1e3*t.clock]}const ge=function(e,t,n=!0){return ue(e,t,n,me)},fe=function(e,t,r,i=!0){return ue(e,t,i,n().partial(he,r))},ve=function(e,t,r,i=!0){return ue(e,t,i,n().partial(ce,r))},ye=function(t,n){const r=new e.MutableDataFrame({refId:n.refId,name:"macros",fields:[{name:"Host",type:e.FieldType.string},{name:"Macros",type:e.FieldType.string},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.string}]});for(let n=0;n<t.length;n++){const i=t[n],o={Host:i.hosts[0].name,Macros:i.macro,[e.TIME_SERIES_VALUE_FIELD_NAME]:i.value};r.add(o)}return r},be=function(e,t,r){const i=new(le());i.addColumn({text:"Host"}),i.addColumn({text:"Item"}),i.addColumn({text:"Key"}),i.addColumn({text:"Last value"});const o=n().groupBy(e,"itemid");return n().each(t,(e=>{const t=o[e.itemid]||[],a=n().last(t);let s=a?a.value:null;if(r.options.skipEmptyValues&&(!s||""===s))return;r.textFilter&&(s=pe(s,r.textFilter,r.useCaptureGroups));let l=n().first(e.hosts);l=l?l.name:"",i.rows.push([l,e.name,e.key_,s])})),i},Ee=function(e,t,n){const r=n[e.serviceid].sla;if("status"===t){const i=parseInt(n[e.serviceid].status,10);return{target:e.name+" "+t,datapoints:[[i,1e3*r[0].to]]}}{let n;const i=[];for(n=0;n<r.length;n++)0===n&&i.push([r[n][t],1e3*r[n].from]),i.push([r[n][t],1e3*r[n].to]);return{target:e.name+" "+t,datapoints:i}}},Ie=function(t,r,i,o){if(n().isArray(t)){const i=function(e){const t=n().uniq(n().flattenDeep(n().map(e,(e=>n().map(e.groups,"name"))))),r={};return n().each(t,(e=>{r[e]={0:0,1:0,2:0,3:0,4:0,5:0}})),n().each(e,(e=>{n().each(e.groups,(t=>{r[t.name][e.priority]++}))})),r}(t),a=new e.MutableDataFrame({name:`Triggers ${o.refId}`,refId:o.refId,fields:[{name:"Host group",type:e.FieldType.string,values:new e.ArrayVector}]});for(let t=y.length-1;t>=0;t--)a.fields.push({name:y[t].text,type:e.FieldType.number,config:{unit:"none",decimals:0},values:new e.ArrayVector});const s=null==r?void 0:r.map((e=>e.name));return null==s||s.forEach((e=>{a.add({"Host group":e,Disaster:i[e]?i[e][5]:0,High:i[e]?i[e][4]:0,Average:i[e]?i[e][3]:0,Warning:i[e]?i[e][2]:0,Information:i[e]?i[e][1]:0,"Not classified":i[e]?i[e][0]:0})})),a}{let n=null;try{n=Number(t)}catch(e){console.log("Error when handling triggers count: ",e)}return new e.MutableDataFrame({name:`Count ${o.refId}`,refId:o.refId,fields:[{name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,values:new e.ArrayVector([1e3*i[1]])},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.number,values:new e.ArrayVector([n])}],length:1})}},we=function(e){return n().forEach(e,(e=>{e.datapoints=n().sortBy(e.datapoints,(e=>e[1]))})),e},Te=function(t,n,r,i){const{datapoints:o,scopedVars:a,target:s,item:l}=t,u={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(o.map((e=>e[1])))};let c;e.FieldType.string,c=new e.ArrayVector(o.map((e=>e[0])));const p={name:e.TIME_SERIES_VALUE_FIELD_NAME,type:null!=i?i:e.FieldType.number,labels:{},config:{displayNameFromDS:s,custom:{}},values:c};var d,m,h,g,f;if(a&&(u.config.custom={itemInterval:null===(d=a.__zbx_item_interval)||void 0===d?void 0:d.value},p.labels={host:null===(m=a.__zbx_host_name)||void 0===m?void 0:m.value,item:null===(h=a.__zbx_item)||void 0===h?void 0:h.value,item_key:null===(g=a.__zbx_item_key)||void 0===g?void 0:g.value},p.config.custom={itemInterval:null===(f=a.__zbx_item_interval)||void 0===f?void 0:f.value}),l){var v;const t=z(l.units);t&&(console.log(`Datasource: unit detected: ${t} (${l.units})`),p.config.unit=t,"percent"===t&&(p.config.min=0,p.config.max=100));const i=function(t,n){const{valuemapid:r}=t,i=null==n?void 0:n.find((e=>e.valuemapid===r));return i?i.mappings.map(((t,n)=>({type:e.MappingType.ValueToText,options:{value:t.value,text:t.newvalue}}))):null}(l,r);i&&(null===(v=n.options)||void 0===v?void 0:v.useZabbixValueMapping)&&(console.log("Datasource: using Zabbix value mapping"),p.config.mappings=i)}const y=[u,p],b={name:s,refId:n.refId,fields:y,length:o.length};return new e.MutableDataFrame(b)},xe=function(t,r,i){const o=[];if(0===t.length)return[];for(const s of t){const t=(0,e.dataFrameFromJSON)(s),{timeField:l,timeIndex:u}=(0,e.getTimeField)(t);for(let e=0;e<t.fields.length;e++){var a;const s=t.fields[e];if(e===u||!s.values||!s.values.length)continue;const c=[];for(let e=0;e<s.values.length;e++){const t=s.values.get(e);null!==t&&c.push({time:l.values.get(e)/1e3,value:t})}const p=s.name,d=n().find(r,{itemid:p});let m=1e6*i.intervalMs;const h=1e6*j(d.delay);m=Math.max(m,h),0===m&&(m=null);let g=d.name;(null===(a=d.hosts)||void 0===a?void 0:a.length)>0&&(g=`${d.hosts[0].name}: ${g}`);const f={ts:c,meta:{name:g,item:d,interval:m}};o.push(f)}}return o},Oe=function(e,t){const n=[];if(0===e.length)return[];for(const r of e){const e=[];if(!r.datapoints)continue;const i=r.datapoints;for(let t=0;t<i.length;t++)e.push({time:i[t][1]/1e3,value:i[t][0]});let o=1e6*j(t);0===o&&(o=null);const a={ts:e,meta:{name:r.target,interval:null,item:{}}};n.push(a)}return n},Se=function(t){if(!t||t.length<2)return!1;const n=t[0].fields.find((t=>t.type===e.FieldType.time));if(!n)return!1;for(let r=1;r<t.length;r++){const i=t[r].fields.find((t=>t.type===e.FieldType.time));for(let e=0;e<Math.min(t.length,2);e++)if(i.values.get(e)!==n.values.get(e))return!1}return!0},Pe=function(t){const n=function(t){let n=0,r=0;for(let i=0;i<t.length;i++){const o=t[i].fields.find((t=>t.type===e.FieldType.time));o.values.length>r&&(r=o.values.length,n=i)}return n}(t),r=t[n].fields.find((t=>t.type===e.FieldType.time));if(!r)return[];const i=[r];for(let n=0;n<t.length;n++){const o=t[n].fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));o&&(o.name=t[n].name,r.values.length-o.values.length==1&&o.values.add(null),i.push(o))}return[{name:"wide",fields:i,length:r.values.length}]},Ae=function(t){if(!t||0===t.length)return t;let n=t[0].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);for(let r=0;r<t.length;r++){const i=t[r].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);i<n&&(n=i)}for(let i=0;i<t.length;i++){const o=t[i],a=o.fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)),s=o.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME)),l=a.values.get(0);if(l>n){var r;console.log("Data frames: adding missing points");let t=a.values.toArray(),i=s.values.toArray();const o=[],u=[],c=null===(r=a.config.custom)||void 0===r?void 0:r.itemInterval;for(let e=n;e<l;e+=c)o.push(e),u.push(null);t=o.concat(t),i=u.concat(i),a.values=new e.ArrayVector(t),s.values=new e.ArrayVector(i)}}return t},De=function(e){for(let n=0;n<e.data.length;n++){const r=e.data[n];for(const e of r.fields){var t;const n=null===(t=e.config.custom)||void 0===t?void 0:t.units;if(n){const t=z(n);t&&(e.config.unit=t,"percent"===t&&(e.config.min=0,e.config.max=100))}}}return e};function Ce(e,t){const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=t[Number(i.objectid)];if(o){const e={timestamp:Number(i.clock),triggerid:i.objectid,eventid:i.eventid,name:i.name,severity:i.severity,acknowledged:i.acknowledged,acknowledges:i.acknowledges,tags:i.tags,suppressed:i.suppressed,suppression_data:i.suppression_data,description:i.name||o.description,comments:o.comments,value:o.value,opdata:i.opdata,groups:o.groups,hosts:o.hosts,items:o.items,alerts:o.alerts,url:o.url,expression:o.expression,correlation_mode:o.correlation_mode,correlation_tag:o.correlation_tag,manual_close:o.manual_close,state:o.state,error:o.error};n.push(e)}}return n}function Re(e,t,n){const{valueFromEvent:r}=n,i=[];for(let n=0;n<e.length;n++){const o=e[n],a=t[Number(o.objectid)];if(a){const e={value:r?o.value:a.value,timestamp:Number(o.clock),triggerid:o.objectid,eventid:o.eventid,name:o.name,severity:o.severity,acknowledged:o.acknowledged,acknowledges:o.acknowledges,tags:o.tags,suppressed:o.suppressed,description:a.description,comments:a.comments,groups:a.groups,hosts:a.hosts,items:a.items,alerts:a.alerts,url:a.url,expression:a.expression,correlation_mode:a.correlation_mode,correlation_tag:a.correlation_tag,manual_close:a.manual_close,state:a.state,error:a.error};i.push(e)}}return i}const Fe=function(e,t){return n().each(e,(e=>{e.datasource=t.datasource})),e},$e=function(e,t){return e.forEach((e=>{if(e.hosts&&e.hosts.length){const n=e.hosts[0];if("0"!==n.proxy_hostid){const e=t[n.proxy_hostid];n.proxy=e?e.host:""}}})),e},je=function(t,n){if(n)return t.forEach((t=>{var r;if(null===(r=t.acknowledges)||void 0===r?void 0:r.length)for(let r=0;r<t.acknowledges.length;r++){const i=t.acknowledges[r];let o=n[i.userid];o||"1"!==i.userid||(o={username:"Admin"}),i.user=(null==o?void 0:o.username)||"",i.name=(null==o?void 0:o.name)||"",i.surname=(null==o?void 0:o.surname)||"";const a=1e3*Number(i.clock);isNaN(a)||(i.time=(0,e.dateTime)(a).format("YYYY-MM-DD HH:mm:ss"))}})),t},Ne=function(e){return n().each(e,(e=>{e.hostInMaintenance=n().some(e.hosts,(e=>"1"===e.maintenance_status)),e.maintenance=!1,"1"===e.suppressed&&(e.maintenance=!0)})),e},ke=function(e,t){return n().each(e,(e=>{e.showAckButton=t})),e},Le=function(e,t){const r=t.trigger.filter;return r&&(e=function(e,t){return C(t)?n().filter(e,(e=>F(t).test(e.description))):n().filter(e,(e=>e.description===t))}(e,r)),t.options.hostsInMaintenance||(e=n().filter(e,(e=>!e.maintenance))),e},_e=function(e,t){var r,i;return"severity"===(null===(r=t.options)||void 0===r?void 0:r.sortProblems)?e=n().orderBy(e,["severity","eventid"],["desc","desc"]):"lastchange"===(null===(i=t.options)||void 0===i?void 0:i.sortProblems)&&(e=n().orderBy(e,["timestamp","eventid"],["desc","desc"])),e},Me=function(t,n){const r={name:"Problems",type:e.FieldType.other,values:new e.ArrayVector(t),config:{custom:{type:"problems"}}};return{name:"problems",refId:(null==n?void 0:n.refId)||"A",fields:[r],length:t.length}};var Ve=g(8873),qe=g.n(Ve);class Be{cacheRequest(e,t,n){return function(e,t,n,r){return function(){r.cache[t]||(r.cache[t]={});const i=r.cache[t],o=He(arguments);return r.cacheEnabled&&!r._isExpired(i[o])?Promise.resolve(i[o].value):e.apply(n,arguments).then((e=>(void 0!==e&&(i[o]={value:e,timestamp:Date.now()}),e)))}}(e,t,n,this)}proxify(e,t,n){return this.promises[t]||(this.promises[t]={}),function(e,t,n){return function(){const r=He(arguments);return t[r]||(t[r]=Promise.resolve(e.apply(n,arguments).then((e=>(t[r]=null,e))).catch((e=>{throw t[r]=null,e})))),t[r]}}(e,this.promises[t],n)}proxifyWithCache(e,t,n){const r=this.proxify(e,t,n);return this.cacheRequest(r,t,n)}_isExpired(e){if(e){const t=Date.now()-e.timestamp;return!(e.timestamp&&t<this.ttl)}return!0}constructor(e){this.cacheEnabled=e.enabled,this.ttl=e.ttl||6e5,this.cache={},this.promises={}}}function He(e){return function(e){let t,n,r,i=0;if(0!==e.length)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}(JSON.stringify(e))}const ze={0:"history",1:"history_str",2:"history_log",3:"history_uint",4:"history_text"},We={0:"trends",3:"trends_uint"},Ge={avg:"value_avg",min:"value_min",max:"value_max",sum:"num*value_avg"};class Ue{static loadDatasource(e,t){if(!t&&void 0!==e){const r=n().find((0,re.getDataSourceSrv)().getList(),{id:e});if(!r)return Promise.reject(`Data Source with ID ${e} not found`);t=r.name}return t?(0,re.getDataSourceSrv)().get(t):Promise.reject("Data Source name should be specified")}loadDBDataSource(){return Ue.loadDatasource(this.datasourceId,this.datasourceName).then((e=>(this.datasourceTypeId=e.meta.id,this.datasourceName||(this.datasourceName=e.name),this.datasourceId||(this.datasourceId=e.id),e)))}constructor(e){this.datasourceId=e.datasourceId,this.datasourceName=e.datasourceName,this.datasourceTypeId=null}}const Qe={DBConnector:Ue,DEFAULT_QUERY_LIMIT:1e4,HISTORY_TO_TABLE_MAP:ze,TREND_TO_TABLE_MAP:We,consolidateByFunc:{avg:"AVG",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},consolidateByTrendColumns:Ge};var Xe=g(7399),Ze=g.n(Xe);function Ye(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Je(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ye(o,r,i,a,s,"next",e)}function s(e){Ye(o,r,i,a,s,"throw",e)}a(void 0)}))}}const Ke=(null===e.rangeUtil||void 0===e.rangeUtil?void 0:e.rangeUtil.roundInterval)||Ze().roundInterval||Ze().round_interval;class et{request(e,t){return this.version?this.backendAPIRequest(e,t):this.initVersion().then((()=>this.request(e,t)))}backendAPIRequest(e,t={}){var n=this;return Je((function*(){var r;const i={url:n.backendAPIUrl,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{datasourceId:n.datasourceId,method:e,params:t}};(n.requestOptions.basicAuth||n.requestOptions.withCredentials)&&(i.withCredentials=!0),n.requestOptions.basicAuth&&(i.headers.Authorization=n.requestOptions.basicAuth);const o=yield(0,re.getBackendSrv)().fetch(i).toPromise();return null==o||null===(r=o.data)||void 0===r?void 0:r.result}))()}getVersion(){return this.backendAPIRequest("apiinfo.version")}initVersion(){return this.version?Promise.resolve(this.version):(this.getVersionPromise||(this.getVersionPromise=Promise.resolve(this.getVersion().then((e=>(e?console.log(`Zabbix version detected: ${e}`):console.log("Failed to detect Zabbix version, use default 3.0.0"),this.version=e||"3.0.0",this.getVersionPromise=null,e))))),this.getVersionPromise)}isZabbix54OrHigher(){return qe().gte(this.version,"5.4.0")}acknowledgeEvent(e,t,n,r){n||(n=qe().gte(this.version,"4.0.0")?4:0);const i={eventids:e,message:t,action:n};return void 0!==r&&(i.severity=r),this.request("event.acknowledge",i)}getGroups(){return this.request("hostgroup.get",{output:["name","groupid"],sortfield:"name",real_hosts:!0})}getHosts(e){const t={output:["hostid","name","host"],sortfield:"name"};return e&&(t.groupids=e),this.request("host.get",t)}getApps(e){var t=this;return Je((function*(){if(t.isZabbix54OrHigher())return[];const n={output:"extend",hostids:e};return t.request("application.get",n)}))()}getItems(e,t,n,r){const i={output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],sortfield:"name",webitems:!0,filter:{},selectHosts:["hostid","name","host"]};if(e&&(i.hostids=e),t&&(i.applicationids=t),"num"===n&&(i.filter.value_type=[0,3]),"text"===n&&(i.filter.value_type=[1,2,4]),this.isZabbix54OrHigher()&&(i.selectTags="extend",r)){const e=r.split(",");let t=[];for(let n=0;n<e.length;n++){const r=M(e[n]);t.push({tag:r.tag,value:r.value,operator:"1"})}i.tags=t,i.evaltype=2}return this.request("item.get",i).then(O)}getItemsByIDs(e){const t={itemids:e,output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],webitems:!0,selectHosts:["hostid","name"]};return this.isZabbix54OrHigher()&&(t.selectTags="extend"),this.request("item.get",t).then((e=>O(e)))}getMacros(e){const t={output:"extend",hostids:e};return this.request("usermacro.get",t)}getUserMacros(e){const t={output:"extend",hostmacroids:e,selectHosts:["hostid","name"]};return this.request("usermacro.get",t)}getGlobalMacros(){return this.request("usermacro.get",{output:"extend",globalmacro:!0})}getLastValue(e){const t={output:["lastvalue"],itemids:e};return this.request("item.get",t).then((e=>e.length?e[0].lastvalue:null))}getHistory(e,t,r){const i=n().groupBy(e,"value_type"),o=n().map(i,((e,i)=>{const o={output:"extend",history:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(o.time_till=r),this.request("history.get",o)}));return Promise.all(o).then(n().flatten)}getTrend_ZBXNEXT1193(e,t,r){const i=n().groupBy(e,"value_type"),o=n().map(i,((e,i)=>{const o={output:"extend",trend:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(o.time_till=r),this.request("trend.get",o)}));return Promise.all(o).then(n().flatten)}getTrend_30(e,t,r,i){const o={output:["itemid","clock",i],itemids:n().map(e,"itemid"),time_from:t};return r&&(o.time_till=r),this.request("trend.get",o)}getITService(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getServices(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getSLAList(){return this.request("sla.get",{output:"extend"})}getSLA(e,t,n){const[r,i]=t;let o=[{from:r,to:i}];"auto"===n.slaInterval?o=rt(t,nt(n.intervalMs)):"none"!==n.slaInterval&&(o=rt(t,N(n.slaInterval)/1e3));const a={serviceids:e,intervals:o};return this.request("service.getsla",a)}getSLA60(e,t,n){var r=this;return Je((function*(){const[i,o]=t;let a=[{from:i,to:o}];if("auto"===n.slaInterval){const e=nt(n.intervalMs);a=rt(t,e)}else if("none"!==n.slaInterval){const e=N(n.slaInterval)/1e3;a=rt(t,e)}const s={output:"extend",serviceids:e},l=yield r.request("sla.get",s);if(0===l.length)return{};const u={slaid:l[0].slaid,serviceids:e,period_from:i,period_to:o,periods:Math.min(a.length,100)},c=yield r.request("sla.getsli",u);if(0===c.length)return{};const p={};return c.serviceids.forEach((e=>{p[e]={sla:[]}})),c.sli.forEach(((e,t)=>{e.forEach(((e,n)=>{p[c.serviceids[n]].sla.push({downtimeTime:e.downtime,okTime:e.uptime,sla:e.sli,from:c.periods[t].period_from,to:c.periods[t].period_to})}))})),p}))()}getSLI(e,t,n,r){var i=this;return Je((function*(){const[o,a]=n;let s=[{from:o,to:a}];if("auto"===r.slaInterval){const e=nt(r.intervalMs);s=rt(n,e)}else if("none"!==r.slaInterval){const e=N(r.slaInterval)/1e3;s=rt(n,e)}const l={slaid:e,serviceids:t,period_from:o,period_to:a,periods:Math.min(s.length,100)};return yield i.request("sla.getsli",l)}))()}getProblems(e,t,n,r){const{timeFrom:i,timeTo:o,recent:a,severities:s,limit:l,acknowledged:u,tags:c,evaltype:p}=r,d={output:"extend",selectAcknowledges:"extend",selectSuppressionData:"extend",selectTags:"extend",source:"0",object:"0",sortfield:["eventid"],sortorder:"DESC",evaltype:"0",groupids:e,hostids:t,applicationids:n,recent:a};return s&&(d.severities=s),void 0!==u&&(d.acknowledged=u),c&&(d.tags=c),p&&(d.evaltype=p),l&&(d.limit=l),(i||o)&&(d.time_from=i,d.time_till=o),this.request("problem.get",d).then(q)}getTriggersByIds(e){const t={output:"extend",triggerids:e,expandDescription:!0,expandData:!0,expandComment:!0,expandExpression:!0,monitored:!0,skipDependent:!0,selectGroups:["name","groupid"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid","description"],selectItems:["itemid","name","key_","lastvalue"],preservekeys:"1"};return this.request("trigger.get",t).then(q)}getTriggers(e,t,n,r){const{showTriggers:i,maintenance:o,timeFrom:a,timeTo:s}=r,l={output:"extend",groupids:e,hostids:t,applicationids:n,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,filter:{value:1},selectGroups:["groupid","name"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid"],selectItems:["itemid","name","key_","lastvalue"],selectLastEvent:"extend",selectTags:"extend"};return i===I.Problems?l.filter.value=1:i!==I.Recent&&i!==I.History||(l.filter.value=[0,1]),o&&(l.maintenance=!0),(a||s)&&(l.lastChangeSince=a,l.lastChangeTill=s),this.request("trigger.get",l)}getEvents(e,t,n,r,i){const o={output:"extend",time_from:t,time_till:n,objectids:e,select_acknowledges:"extend",selectHosts:"extend",value:r};return i&&(o.limit=i,o.sortfield="clock",o.sortorder="DESC"),this.request("event.get",o).then(q)}getEventsHistory(e,t,n,r){const{timeFrom:i,timeTo:o,severities:a,limit:s,value:l,tags:u,evaltype:c}=r,p={output:"extend",time_from:i,time_till:o,value:"1",source:"0",object:"0",evaltype:"0",sortfield:["eventid"],sortorder:"DESC",select_acknowledges:"extend",selectTags:"extend",selectSuppressionData:["maintenanceid","suppress_until"],groupids:e,hostids:t,applicationids:n};return s&&(p.limit=s),a&&(p.severities=a),l&&(p.value=l),u&&(p.tags=u),c&&(p.evaltype=c),this.request("event.get",p).then(q)}getExtendedEventData(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",selectTags:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t)}getEventAlerts(e){const t={eventids:e,output:["alertid","eventid","message","clock","error"],selectUsers:!0};return this.request("alert.get",t)}getAcknowledges(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t).then((e=>n().filter(e,(e=>e.acknowledges.length))))}getAlerts(e,t,n){const r={output:"extend",itemids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend"};return(t||n)&&(r.lastChangeSince=t,r.lastChangeTill=n),this.request("trigger.get",r)}getHostAlerts(e,t,n){var r=this;return Je((function*(){const{minSeverity:i,acknowledged:o,tags:a,count:s,timeFrom:l,timeTo:u}=n,c={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["hostid","host","name"]};s&&1!==o&&(c.countOutput=!0,0===o&&(c.withLastEventUnacknowledged=!0)),t&&t.length&&(c.applicationids=t),(l||u)&&(c.lastChangeSince=l,c.lastChangeTill=u),a&&(c.tags=a,c.evaltype=0);let p=yield r.request("trigger.get",c);return s&&1!==o||(p=tt(p,o),s&&(p=p.length)),p}))()}getHostICAlerts(e,t,n,r){const{minSeverity:i,acknowledged:o,count:a,timeFrom:s,timeTo:l}=r,u={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return a&&1!==o&&(u.countOutput=!0,0===o&&(u.withLastEventUnacknowledged=!0)),t&&t.length&&(u.applicationids=t),n&&n.length&&(u.itemids=n),(s||l)&&(u.lastChangeSince=s,u.lastChangeTill=l),this.request("trigger.get",u).then((e=>(a&&1!==o||(e=tt(e,o),a&&(e=e.length)),e)))}getHostPCAlerts(e,t,n,r){const{minSeverity:i,acknowledged:o,count:a,timeFrom:s,timeTo:l}=r,u={output:"extend",hostids:e,triggerids:n,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return a&&0!==o&&1!==o&&(u.countOutput=!0),t&&t.length&&(u.applicationids=t),(s||l)&&(u.lastChangeSince=s,u.lastChangeTill=l),this.request("trigger.get",u).then((e=>(a&&0!==o&&1!==o||(e=tt(e,o),a&&(e=e.length)),e)))}getProxies(){return this.request("proxy.get",{output:["proxyid","host"]})}getScripts(e,t){const n={output:"extend",hostids:e};return this.request("script.get",n).then(q)}executeScript(e,t){const n={hostid:e,scriptid:t};return this.request("script.execute",n)}getValueMappings(){return this.request("valuemap.get",{output:"extend",selectMappings:"extend"})}getUsers(){return this.request("user.get",{output:["userid","username","name","surname"]})}constructor(e,t,n){this.datasourceId=n,this.backendAPIUrl=`/api/datasources/${this.datasourceId}/resources/zabbix-api`,this.requestOptions={basicAuth:e,withCredentials:t},this.getTrend=this.getTrend_ZBXNEXT1193,this.initVersion()}}function tt(e,t){return 0===t?n().filter(e,(e=>"0"===e.lastEvent.acknowledged)):1===t?n().filter(e,(e=>"1"===e.lastEvent.acknowledged)):e}function nt(e){const t=Ke(100*e)/1e3;return Math.max(t,3600)}function rt(e,t){let[n,r]=e;const i=[];n=Math.floor(n/t)*t,r=Math.ceil(r/t)*t;for(let e=n;e<=r-t;e+=t)i.push({from:e,to:e+t});return i}const it={historyQuery:function(e,t,n,r,i,o){const a=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${a} AS time_sec, ${o}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${a}, metric\n      ORDER BY time_sec ASC\n  `},trendsQuery:function(e,t,n,r,i,o,a){const s=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${s} AS time_sec, ${o}(${a}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${s}, metric\n      ORDER BY time_sec ASC\n  `},testQuery:function(){return"SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value\n          FROM trends_uint LIMIT 1"}},ot="FM99999999999999999999",at=`\n    SELECT to_char(itemid, '${ot}') AS metric, clock AS time, value_avg AS value\n    FROM trends_uint LIMIT 1\n`,st={historyQuery:function(e,t,n,r,i,o){return`\n      SELECT to_char(itemid, '${ot}') AS metric, clock / ${i} * ${i} AS time, ${o}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},trendsQuery:function(e,t,n,r,i,o,a){return`\n      SELECT to_char(itemid, '${ot}') AS metric, clock / ${i} * ${i} AS time, ${o}(${a}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},testQuery:function(){return at}};class lt extends Ue{loadSQLDialect(){"postgres"===this.datasourceTypeId?this.sqlDialect=st:this.sqlDialect=it}testDataSource(){const e=this.sqlDialect.testQuery();return this.invokeSQLQuery(e)}getHistory(e,t,r,i){const{aggFunction:o,intervalSec:a}=ut(t,r,i),s=n().groupBy(e,"value_type"),l=n().map(s,((e,i)=>{const s=n().map(e,"itemid").join(", "),l=ze[i];let u=this.sqlDialect.historyQuery(s,l,t,r,a,o);return u=L(u),this.invokeSQLQuery(u)}));return Promise.all(l).then((e=>n().flatten(e)))}getTrends(e,t,r,i){const{consolidateBy:o}=i,{aggFunction:a,intervalSec:s}=ut(t,r,i),l=n().groupBy(e,"value_type"),u=n().map(l,((e,i)=>{const l=n().map(e,"itemid").join(", "),u=We[i];let c=n().includes(["avg","min","max","sum"],o)?o:"avg";c=Qe.consolidateByTrendColumns[c];let p=this.sqlDialect.trendsQuery(l,u,t,r,s,a,c);return p=L(p),this.invokeSQLQuery(p)}));return Promise.all(u).then((e=>n().flatten(e)))}invokeSQLQuery(e){const t={refId:"A",format:"time_series",datasourceId:this.datasourceId,rawSql:e,maxDataPoints:this.limit};return(0,re.getBackendSrv)().datasourceRequest({url:"/api/ds/query",method:"POST",data:{queries:[t]}}).then((e=>{const t=e.data.results;return t.A?t.A.frames:null}))}constructor(e){super(e),this.limit=e.limit||1e4,this.sqlDialect=null,super.loadDBDataSource().then((()=>{this.loadSQLDialect()}))}}function ut(e,t,n){const{intervalMs:r}=n;let{consolidateBy:i}=n,o=Math.ceil(r/1e3);const a=Math.ceil((t-e)/o);return o=Math.ceil((t-e)/a),i=i||"avg",{aggFunction:Qe.consolidateByFunc[i],intervalSec:o}}function ct(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}const pt={avg:"MEAN",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"};class dt extends Ue{testDataSource(){return this.influxDS.testDatasource().then((e=>e.status&&"error"===e.status?Promise.reject({data:{message:`InfluxDB connection error: ${e.message}`}}):e))}getHistory(t,r,i,o){const{intervalMs:a,retentionPolicy:s}=o;let{consolidateBy:l}=o;const u=Math.ceil(a/1e3),c={timeFrom:r,timeTill:i};l=l||"avg";const p=n().groupBy(t,"value_type"),d=n().map(p,((e,t)=>{const r=n().map(e,"itemid"),i=ze[t],o=this.buildHistoryQuery(r,i,c,u,l,s);return this.invokeInfluxDBQuery(o)}));return Promise.all(d).then(n().flatten).then((t=>function(t){if(!t)return[];const n=[];for(let o=0;o<t.length;o++){const a=t[o];if(a.error){const e=`InfluxDB error: ${a.error}`;return Promise.reject(new Error(e))}if(!a||!a.series)continue;const s=t[o].series;for(let t=0;t<s.length;t++){var r,i;const a=s[t],l=[],u=[];if(a.values)for(o=0;o<a.values.length;o++)l.push(a.values[o][0]),u.push(a.values[o][1]);const c={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{},values:new e.ArrayVector(l)},p={name:null==a||null===(r=a.tags)||void 0===r?void 0:r.itemid,type:e.FieldType.number,config:{},values:new e.ArrayVector(u)};n.push(new e.MutableDataFrame({name:null==a||null===(i=a.tags)||void 0===i?void 0:i.itemid,fields:[c,p]}))}}return n.map((t=>(0,e.dataFrameToJSON)(t)))}(t)))}getTrends(e,t,n,r){return r.retentionPolicy=this.retentionPolicy,this.getHistory(e,t,n,r)}buildHistoryQuery(e,t,n,r,i,o){const{timeFrom:a,timeTill:s}=n;let l="value";return o&&(l=Ge[i]||"value_avg"),L(`SELECT ${pt[i]||i}("${l}")\n                   FROM ${o?`"${o}"."${t}"`:`"${t}"`}\n                   WHERE ${this.buildWhereClause(e)}\n                     AND "time" >= ${a}s\n                     AND "time" <= ${s}s\n                   GROUP BY time(${r}s), "itemid" fill(none)`)}buildWhereClause(e){return`(${e.map((e=>`"itemid" = '${e}'`)).join(" OR ")})`}invokeInfluxDBQuery(e){var t,n=this;return(t=function*(){const t=yield n.influxDS._seriesQuery(e).toPromise();return(null==t?void 0:t.results)||[]},function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(e){ct(o,r,i,a,s,"next",e)}function s(e){ct(o,r,i,a,s,"throw",e)}a(void 0)}))})()}constructor(e){super(e),this.retentionPolicy=e.retentionPolicy,super.loadDBDataSource().then((e=>(this.influxDS=e,e)))}}function mt(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function ht(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){mt(o,r,i,a,s,"next",e)}function s(e){mt(o,r,i,a,s,"throw",e)}a(void 0)}))}}const gt=["getHistory","getTrend","getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","getSLA","getVersion","getProxies","getEventAlerts","getExtendedEventData","getProblems","getEventsHistory","getTriggersByIds","getScripts","getValueMappings","getSLAList","getUsers"],ft=["getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getITService","getProxies","getValueMappings","getSLAList","getUsers"],vt=["getHistory","getTrend","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","acknowledgeEvent","getProxies","getEventAlerts","getExtendedEventData","getScripts","executeScript","getValueMappings","getSLAList","getUsers"];class yt{initDBConnector(e,t,n){return Ue.loadDatasource(e,t).then((r=>{const i={datasourceId:e,datasourceName:t};return"influxdb"===r.type?(i.retentionPolicy=n.dbConnectionRetentionPolicy,this.dbConnector=new dt(i)):this.dbConnector=new lt(i),this.dbConnector}))}proxifyRequests(){for(const e of gt)this.zabbixAPI[e]=this.cachingProxy.proxify(this.zabbixAPI[e],e,this.zabbixAPI)}cacheRequests(){for(const e of ft)this.zabbixAPI[e]=this.cachingProxy.cacheRequest(this.zabbixAPI[e],e,this.zabbixAPI)}bindRequests(){for(const e of vt)this[e]=this.zabbixAPI[e].bind(this.zabbixAPI)}testDataSource(){let e,t;return this.getVersion().then((t=>(e=t,this.getAllGroups()))).then((()=>this.enableDirectDBConnection?this.dbConnector.testDataSource():Promise.resolve())).catch((e=>Promise.reject(e))).then((n=>(n&&(t={dsType:this.dbConnector.datasourceTypeName||this.dbConnector.datasourceTypeId,dsName:this.dbConnector.datasourceName}),{zabbixVersion:e,dbConnectorStatus:t})))}getVersion(){var e=this;return ht((function*(){return e.version||(e.zabbixAPI.version?e.version=e.zabbixAPI.version:e.version=yield e.zabbixAPI.initVersion()),e.version}))()}supportsApplications(){const e=this.version||this.zabbixAPI.version;return!e||qe().lt(e,"5.4.0")}supportSLA(){const e=this.version||this.zabbixAPI.version;return!e||qe().gte(e,"6.0.0")}isZabbix54OrHigher(){var e=this;return ht((function*(){const t=yield e.zabbixAPI.initVersion();return!!t&&qe().gte(t,"5.4.0")}))()}isZabbix54OrHigherSync(){return!!this.version&&qe().gte(this.version,"5.4.0")}getItemsFromTarget(e,t){const r=n().map(["group","host","application","itemTag","item"],(t=>e[t].filter));return this.getItems(...r,t)}getMacrosFromTarget(e){const t=n().map(["group","host","macro"],(t=>e[t].filter));return this.getUMacros(...t)}getHostsApsFromTarget(e){var t=this;return ht((function*(){const n=["group","host","application"].map((t=>e[t].filter)),r=yield Promise.all([t.getHosts(...n),t.getApps(...n)]),i=r[0];let o=r[1];return o.appFilterEmpty&&(o=[]),[i,o]}))()}getHostsFromICTarget(e,t){var n=this;return ht((function*(){const r=["group","host","application","itemTag","item"].map((t=>e[t].filter)),[i,o]=yield n.getHostsApsFromTarget(e);return[i,o,yield n.getItems(...r,t)]}))()}getHostsFromPCTarget(e,t){var n=this;return ht((function*(){const r=["group","host","application","proxy","trigger"].map((t=>e[t].filter)),[i,o]=yield n.getHostsApsFromTarget(e);return[i,o,yield n.getCProblems(...r,t)]}))()}getAllGroups(){return this.zabbixAPI.getGroups()}getGroups(e){return this.getAllGroups().then((t=>Et(t,e)))}getAllHosts(e){return this.getGroups(e).then((e=>{const t=n().map(e,"groupid");return this.zabbixAPI.getHosts(t)}))}getHosts(e,t){return this.getAllHosts(e).then((e=>Et(e,t)))}getAllApps(e,t){var r=this;return ht((function*(){return yield r.getVersion(),r.supportsApplications()?r.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");return r.zabbixAPI.getApps(t)})):[]}))()}getApps(e,t,r){var i=this;return ht((function*(){yield i.getVersion();const o=!i.supportsApplications();return i.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");if(r&&!o)return i.zabbixAPI.getApps(t).then((e=>It(e,r)));{const e=t;return e.hostids=t,e.appFilterEmpty=!0,Promise.resolve(e)}}))}))()}getAllMacros(e,t){var n=this;return ht((function*(){const r=yield n.getHosts(e,t),i=null==r?void 0:r.map((e=>e.hostid));return n.zabbixAPI.getMacros(i)}))()}getUMacros(e,t,r){var i=this;return ht((function*(){return o=yield i.getAllMacros(e,t),C(a=r)?function(e,t){const r=F(t);return n().filter(e,(e=>r.test(null==e?void 0:e.macro)))}(o,a):function(e,t){return n().filter(e,{macro:t})||[]}(o,a);var o,a}))()}getItemTags(e,t,r){var i=this;return ht((function*(){const o=yield i.getAllItems(e,t,null,null,{});let a=n().flatten(o.map((e=>e.tags?e.tags:[])));return a=n().uniqBy(a,(e=>e.tag+e.value||"")),Et(a.map((e=>({name:V(e)}))),r)}))()}getAllItems(e,t,r,i,o={}){var a=this;return ht((function*(){if(!a.isZabbix54OrHigher())return a.getAllItemsBefore54(e,t,r,i,o);const s=yield a.getHosts(e,t),l=n().map(s,"hostid");if(C(i)){const n=yield a.getItemTags(e,t,i);i=n.map((e=>e.name)).join(",")}let u=yield a.zabbixAPI.getItems(l,void 0,o.itemtype,i);return o.showDisabledItems||(u=n().filter(u,{status:"0"})),yield a.expandUserMacro(u,!1)}))()}getAllItemsBefore54(e,t,r,i,o={}){var a=this;return ht((function*(){const i=yield a.getApps(e,t,r);let s;if(i.appFilterEmpty)s=yield a.zabbixAPI.getItems(i.hostids,void 0,o.itemtype,void 0);else{const e=n().map(i,"applicationid");s=yield a.zabbixAPI.getItems(void 0,e,o.itemtype,void 0)}return o.showDisabledItems||(s=n().filter(s,{status:"0"})),yield a.expandUserMacro(s,!1)}))()}expandUserMacro(e,t){const r=function(e){const t=n().map(e,(e=>n().map(e.hosts,"hostid")));return n().uniq(n().flatten(t))}(e);return this.getMacros(r).then((r=>(n().forEach(e,(e=>{var n;n=t?e.url:e.name,S.test(n)&&(t?e.url=P(e,r,t):e.name=P(e,r))})),e)))}getItems(e,t,n,r,i,o={}){return this.getAllItems(e,t,n,r,o).then((e=>It(e,i)))}getItemValues(e,t,r,i,o={}){return this.getItems(e,t,r,null,i,o).then((e=>{let t=[l()().subtract(2,"h").unix(),l()().unix()];o.range&&(t=[o.range.from.unix(),o.range.to.unix()]);const[r,i]=t;return this.zabbixAPI.getHistory(e,r,i).then((e=>e?n().uniq(e.map((e=>e.value))).map((e=>({name:e}))):[]))}))}getITServices(e){var t=this;return ht((function*(){return Et(yield t.zabbixAPI.getITService(),e)}))()}getSLAs(e){var t=this;return ht((function*(){return Et(yield t.zabbixAPI.getSLAList(),e)}))()}getProblems(e,t,r,i,o){const a=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(a).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&"/.*/"!==t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,o))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>Ce(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}getProblemsHistory(e,t,r,i,o){const{valueFromEvent:a}=o,s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(s).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getEventsHistory(e.groupids,e.hostids,e.applicationids,o))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>Re(e,t,{valueFromEvent:a}))).then((e=>this.filterTriggersByProxy(e,i)))}getCProblems(e,t,r,i,o,a){const s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(s).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&"/.*/"!==t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,a))).then((e=>Et(e,o))).then((e=>{const t=null==e?void 0:e.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(t)])})).then((([e,t])=>Ce(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}filterTriggersByProxy(e,t){return this.getFilteredProxies(t).then((n=>{if(t&&"/.*/"!==t&&e){const t=n.map((e=>e.proxyid));e=e.filter((e=>{for(let n=0;n<e.hosts.length;n++){const r=e.hosts[n];if(t.includes(r.proxy_hostid))return!0}return!1}))}return e}))}getFilteredProxies(e){return this.zabbixAPI.getProxies().then((t=>(t.forEach((e=>e.name=e.host)),Et(t,e))))}getHistoryTS(e,t,n){const[r,i]=t;return this.enableDirectDBConnection?this.getHistoryDB(e,r,i,n).then((t=>xe(t,e,n))):this.zabbixAPI.getHistory(e,r,i).then((t=>ge(t,e)))}getTrends(e,t,n){const[r,i]=t;if(this.enableDirectDBConnection)return this.getTrendsDB(e,r,i,n).then((t=>xe(t,e,n)));{const t=n.consolidateBy||n.valueType;return this.zabbixAPI.getTrend(e,r,i).then((n=>fe(n,e,t))).then(we)}}getHistoryText(e,t,n){const[r,i]=t;return e.length?this.zabbixAPI.getHistory(e,r,i).then((t=>"table"===n.resultFormat?be(t,e,n):ve(t,e,n))):Promise.resolve([])}getSLI(t,n,r,i,o){var a=this;return ht((function*(){const s=t.map((e=>e.serviceid));if("status"===i.slaProperty)return function(t,n,r){const i=[];for(let n=0;n<(null==t?void 0:t.length);n++){const r=t[n],o=Number(r.status);i.push({name:r?r.name:n,type:e.FieldType.number,config:{},values:new e.ArrayVector([o])})}const o={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector([Date.now()])};return new e.MutableDataFrame({refId:r.refId,name:"Service status",fields:[o,...i]})}(yield a.zabbixAPI.getServices(s),0,i);const l=n.map((e=>e.slaid));if(l.length>1){const u=null==l?void 0:l.map((e=>a.zabbixAPI.getSLI(e,s,r,o)));return function(t,n,r,i){var o;if(!t||0===(null==t?void 0:t.length))return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[]});const a=t[0],s=[];for(let e=0;e<(null==a||null===(o=a.periods)||void 0===o?void 0:o.length);e++){const t=a.periods[e];s.push(1e3*t.period_from)}const l={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(s)},u=[],c=de(i.slaProperty);for(let i=0;i<t.length;i++){var p,d;const o=t[i],a=[];for(let e=0;e<(null==o||null===(p=o.sli)||void 0===p?void 0:p.length);e++){const t=o.sli[e];for(let e=0;e<t.length;e++){const n=t[e][c];a[e]||(a[e]=[]),a[e].push(n)}}for(let s=0;s<(null==o||null===(d=o.serviceids)||void 0===d?void 0:d.length);s++){const l=null==o?void 0:o.serviceids[s].toString(),c=n.find((e=>e.serviceid===l));let p=`${(null==c?void 0:c.name)||l}`;t.length>1&&(p=`${p}: ${r[i].name}`),u.push({name:p,type:e.FieldType.number,config:{},values:new e.ArrayVector(a[s])})}}return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[l,...u]})}(yield Promise.all(u),t,n,i)}{const n=(null==l?void 0:l.length)>0?l[0]:void 0;return function(t,n,r){var i,o,a;const s=[];for(let e=0;e<(null==t||null===(i=t.periods)||void 0===i?void 0:i.length);e++){const n=t.periods[e];s.push(1e3*n.period_from)}const l={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(s)},u=[],c=[];let p=de(r.slaProperty);for(let e=0;e<(null==t||null===(o=t.sli)||void 0===o?void 0:o.length);e++){const n=t.sli[e];for(let e=0;e<n.length;e++){const t=n[e][p];c[e]||(c[e]=[]),c[e].push(t)}}for(let r=0;r<(null==t||null===(a=t.serviceids)||void 0===a?void 0:a.length);r++){const i=null==t?void 0:t.serviceids[r].toString(),o=n.find((e=>e.serviceid===i));u.push({name:o?o.name:i,type:e.FieldType.number,config:{},values:new e.ArrayVector(c[r])})}return new e.MutableDataFrame({refId:r.refId,name:"SLI",fields:[l,...u]})}(yield a.zabbixAPI.getSLI(n,s,r,o),t,i)}}))()}getSLA(e,t,r,i){var o=this;return ht((function*(){const a=n().map(e,"serviceid");if(o.supportSLA()){const s=yield o.zabbixAPI.getSLA60(a,t,i);return n().map(a,(t=>{const i=n().find(e,{serviceid:t});return Ee(i,r.slaProperty,s)}))}const s=yield o.zabbixAPI.getSLA(a,t,i);return n().map(a,(t=>{const i=n().find(e,{serviceid:t});return Ee(i,r.slaProperty,s)}))}))()}constructor(e){const{basicAuth:t,withCredentials:n,cacheTTL:r,enableDirectDBConnection:i,dbConnectionDatasourceId:o,dbConnectionDatasourceName:a,dbConnectionRetentionPolicy:s,datasourceId:l}=e;this.enableDirectDBConnection=i;const u={enabled:!0,ttl:r};if(this.cachingProxy=new Be(u),this.zabbixAPI=new et(t,n,l),this.proxifyRequests(),this.cacheRequests(),this.bindRequests(),i){const e={dbConnectionRetentionPolicy:s};this.initDBConnector(o,a,e).then((()=>{this.getHistoryDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getHistory,"getHistory",this.dbConnector),this.getTrendsDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getTrends,"getTrends",this.dbConnector)}))}}}function bt(e,t){const r=F(t);return n().filter(e,(e=>r.test(e.name)))}function Et(e,t){return C(t)?bt(e,t):function(e,t){const r=n().find(e,{name:t});return r?[r]:[]}(e,t)}function It(e,t){return C(t)?bt(e,t):function(e,t){return n().filter(e,{name:t})||[]}(e,t)}var wt=g(2650),Tt=g.n(wt),xt=function(){return xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},xt.apply(this,arguments)};function Ot(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var r,i,o=(0,wt.useRef)(0),a=(r=(0,wt.useRef)(!1),i=(0,wt.useCallback)((function(){return r.current}),[]),(0,wt.useEffect)((function(){return r.current=!0,function(){r.current=!1}}),[]),i),s=(0,wt.useState)(n),l=s[0],u=s[1],c=(0,wt.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=++o.current;return l.loading||u((function(e){return xt(xt({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return a()&&r===o.current&&u({value:e,loading:!1}),e}),(function(e){return a()&&r===o.current&&u({error:e,loading:!1}),e}))}),t);return[l,c]}Object.create,Object.create;var St=g(7388);const Pt=({children:e})=>Tt().createElement(St.InlineFieldRow,null,e,Tt().createElement("div",{className:"gf-form gf-form--grow"},Tt().createElement("div",{className:"gf-form-label gf-form-label--grow"})));var At=g(7644);(0,St.stylesFactory)((t=>{const n=t.type===e.GrafanaThemeType.Light?"#497dc0":"#005f81",r=t.type===e.GrafanaThemeType.Light?"#456ba4":"#354f77";return{button:At.css`
      height: 2rem;
      background-image: none;
      background-color: ${n};
      border: 1px solid ${t.palette.gray1};
      border-radius: 1px;
      color: ${t.colors.text};

      i {
        vertical-align: middle;
      }

      &:hover {
        background-color: ${r};
      }
    `,icon:At.css`
      i {
        color: ${t.colors.text};
      }
    `}})),g(2729);Tt().createContext(re.config).Consumer;class Dt extends Tt().Component{renderModal(){const{component:e,props:t}=this.state;if(!e)return null;this.modalRoot.appendChild(this.modalNode);const n=React.createElement(provideTheme(e),t);return ReactDOM.createPortal(n,this.modalNode)}render(){const{children:e}=this.props,t=e;return React.createElement(React.Fragment,null,React.createElement(t,{showModal:this.showModal,hideModal:this.hideModal}),this.renderModal())}constructor(e){super(e),this.modalRoot=document.body,this.modalNode=document.createElement("div"),this.showModal=(e,t)=>{this.setState({component:e,props:t})},this.hideModal=()=>{this.modalRoot.removeChild(this.modalNode),this.setState({component:null,props:{}})},this.state={component:null,props:{}}}}const Ct=({options:e,offset:t,minWidth:n,selected:r,onSelect:i})=>{const o=(0,St.useTheme2)(),a=(0,St.getSelectStyles)(o),s=(0,St.useStyles2)(Ft(n));return Tt().createElement("div",{className:(0,At.cx)(a.menu,s.menuWrapper,{[s.menuLeft]:t.horizontal>0},At.css`
          bottom: ${t.vertical>0?`${t.vertical}px`:"unset"};
          top: ${t.vertical<0?`${Math.abs(t.vertical)}px`:"unset"};
        `)},Tt().createElement("div",{className:s.menu,"aria-label":"Metric picker menu"},Tt().createElement(St.CustomScrollbar,{autoHide:!1,autoHeightMax:"300px",hideHorizontalTrack:!0},Tt().createElement("div",null,Tt().createElement("div",{className:a.optionBody},null==e?void 0:e.map(((e,t)=>Tt().createElement(Rt,{data:e,key:t,onClick:i,isFocused:r===t,hideDescription:!0}))))))))},Rt=Tt().forwardRef((({data:e,isFocused:t,disabled:n,onClick:r,hideDescription:i},o)=>{const a=(0,St.useTheme2)(),s=(0,St.getSelectStyles)(a),l=(0,St.useStyles2)(Ft()),u=(0,At.cx)(s.option,l.menuOptionWrapper,t&&s.optionFocused,n&&l.menuOptionDisabled);return Tt().createElement("div",{ref:o,className:u,"aria-label":"Menu option",onClick:t=>{n||(t.preventDefault(),t.stopPropagation(),r(e))}},Tt().createElement("div",{className:(0,At.cx)(s.optionBody,l.menuOptionBody)},Tt().createElement("span",null,e.label||e.value),!i&&e.description&&Tt().createElement("div",{className:s.optionDescription},e.description)),e.description&&Tt().createElement(St.Tooltip,{content:e.description},Tt().createElement(St.Icon,{name:"info-circle",className:l.menuOptionInfoSign})))}));Rt.displayName="MenuOption";const Ft=e=>t=>({menuWrapper:At.css`
      display: flex;
      max-height: 650px;
      position: absolute;
      z-index: ${t.zIndex.dropdown};
      overflow: hidden;
      min-width: auto;
    `,menu:At.css`
      min-width: ${t.spacing(e||0)};

      & > div {
        padding-top: ${t.spacing(1)};
      }
    `,menuLeft:At.css`
      right: 0;
      flex-direction: row-reverse;
    `,container:At.css`
      padding: ${t.spacing(1)};
      border: 1px ${t.colors.border.weak} solid;
      border-radius: ${t.shape.borderRadius(1)};
      background-color: ${t.colors.background.primary};
      z-index: ${t.zIndex.modal};
    `,menuOptionWrapper:At.css`
      padding: ${t.spacing(.5)};
    `,menuOptionBody:At.css`
      font-weight: ${t.typography.fontWeightRegular};
      padding: ${t.spacing(0,1.5,0,0)};
    `,menuOptionDisabled:At.css`
      color: ${t.colors.text.disabled};
      cursor: not-allowed;
    `,menuOptionInfoSign:At.css`
      color: ${t.colors.text.disabled};
    `}),$t=({value:e,options:t,isLoading:n,width:r,onChange:i})=>{const[o,a]=(0,wt.useState)(!1),[s,l]=(0,wt.useState)(e),[u,c]=(0,wt.useState)(t),[p,d]=(0,wt.useState)(-1),[m]=(0,wt.useState)({vertical:0,horizontal:0}),h=(0,wt.useRef)(null),g=(0,St.useStyles2)(jt),f=(0,At.cx)({[g.inputRegexp]:C(s),[g.inputVariable]:s.startsWith("$")});(0,wt.useEffect)((()=>{c(t)}),[t]);const v=(0,wt.useCallback)((()=>{a(!1)}),[]),y=e=>{const t=(null==e?void 0:e.value)||"";l(t),i(t),v()};return Tt().createElement("div",{"data-testid":"role-picker",style:{position:"relative"},ref:h},Tt().createElement(St.ClickOutsideWrapper,{onClick:()=>o&&v()},Tt().createElement(St.Input,{className:f,value:s,type:"text",onChange:n=>{var r;o||a(!0);const i=null==n||null===(r=n.currentTarget)||void 0===r?void 0:r.value;if(i)if(l(i),e!==i){const e=t.filter((e=>{var t,n;return(null===(t=e.value)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null===(n=e.label)||void 0===n?void 0:n.toLowerCase().includes(i.toLowerCase()))}));c(e)}else c(t);else l(""),c(t)},onBlur:()=>{i(s)},onMouseDown:()=>{a(!0),c(t)},suffix:n&&Tt().createElement(St.Spinner,null),width:r,onKeyDown:e=>{if("ArrowDown"===e.key){o||a(!0),e.preventDefault(),e.stopPropagation();const t=p<u.length-1?p+1:0;d(t)}else if("ArrowUp"===e.key){o||a(!0),e.preventDefault(),e.stopPropagation();const t=p>0?p-1:u.length-1;d(t)}else"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),y(u[p]))}}),o&&Tt().createElement(Ct,{options:u,onSelect:y,offset:m,minWidth:r,selected:p})))},jt=e=>({inputRegexp:At.css`
      input {
        color: ${e.colors.warning.main};
      }
    `,inputVariable:At.css`
      input {
        color: ${e.colors.primary.text};
      }
    `}),Nt=()=>{const e=(0,re.getTemplateSrv)().getVariables().filter((e=>"datasource"!==e.type&&"interval"!==e.type));return null==e?void 0:e.map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};function kt(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Lt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){kt(o,r,i,a,s,"next",e)}function s(e){kt(o,r,i,a,s,"throw",e)}a(void 0)}))}}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_t(e,t,n[t])}))}return e}function Vt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const qt=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],Bt=({annotation:e,onAnnotationChange:t,datasource:r})=>{var i,o,a,s,l,u,c;const p=(e=Z(e)).target,d=(m=Lt((function*(){const e=yield r.zabbix.getAllGroups(),t=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return t.unshift(...Nt()),t})),function(){return m.apply(this,arguments)});var m;const[{loading:h,value:g},f]=Ot(Lt((function*(){return yield d()})),[]),v=function(){var e=Lt((function*(e){const t=r.replaceTemplateVars(e),i=yield r.zabbix.getAllHosts(t);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:y,value:b},E]=Ot(Lt((function*(){return yield v(p.group.filter)})),[p.group.filter]),I=function(){var e=Lt((function*(e,t){const i=r.replaceTemplateVars(e),o=r.replaceTemplateVars(t),a=yield r.zabbix.getAllApps(i,o);let s=null==a?void 0:a.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:T},x]=Ot(Lt((function*(){return yield I(p.group.filter,p.host.filter)})),[p.group.filter,p.host.filter]),O=r.replaceTemplateVars(null===(i=p.group)||void 0===i?void 0:i.filter),S=r.replaceTemplateVars(null===(o=p.host)||void 0===o?void 0:o.filter);(0,wt.useEffect)((()=>{f()}),[]),(0,wt.useEffect)((()=>{E()}),[O]),(0,wt.useEffect)((()=>{x()}),[O,S]);const P=n=>{t(Vt(Mt({},e),{target:n}))},A=e=>t=>{null!==t&&P(Vt(Mt({},p),{[e]:{filter:t}}))},D=e=>()=>{P(Vt(Mt({},p),{options:Vt(Mt({},p.options),{[e]:!p.options[e]})}))};return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:null===(a=p.group)||void 0===a?void 0:a.filter,options:g,isLoading:h,onChange:A("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:null===(s=p.host)||void 0===s?void 0:s.filter,options:b,isLoading:y,onChange:A("host")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Application",labelWidth:12},Tt().createElement($t,{width:24,value:null===(l=p.application)||void 0===l?void 0:l.filter,options:T,isLoading:w,onChange:A("application")})),Tt().createElement(St.InlineField,{label:"Problem",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:null===(u=p.trigger)||void 0===u?void 0:u.filter,placeholder:"Problem name",onBlur:("trigger",e=>{var t;const n=null==e||null===(t=e.currentTarget)||void 0===t?void 0:t.value;null!==n&&P(Vt(Mt({},p),{trigger:{filter:n}}))})}))),Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Min severity",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:null===(c=p.options)||void 0===c?void 0:c.minSeverity,options:qt,onChange:e=>{null!==e.value&&P(Vt(Mt({},p),{options:Vt(Mt({},p.options),{minSeverity:e.value})}))}})),Tt().createElement(St.InlineField,{label:"Show OK events",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:p.options.showOkEvents,onChange:D("showOkEvents")})),Tt().createElement(St.InlineField,{label:"Hide acknowledged events",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:p.options.hideAcknowledged,onChange:D("hideAcknowledged")})),Tt().createElement(St.InlineField,{label:"Show hostname",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:p.options.showHostname,onChange:D("showHostname")}))))};function Ht(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ht(o,r,i,a,s,"next",e)}function s(e){Ht(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wt(e,t,n[t])}))}return e}function Ut(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class Qt extends e.DataSourceApi{query(t){const r=t.targets.map((e=>Q(n().cloneDeep(e)))),i=this.backendQuery(Ut(Gt({},t),{targets:r})),o=this.dbConnectionQuery(Ut(Gt({},t),{targets:r})),a=this.frontendQuery(Ut(Gt({},t),{targets:r})),s=this.annotationRequest(Ut(Gt({},t),{targets:r}));return Promise.all([i,o,a,s]).then((n=>{const[r,i,o,a]=n;return i.data&&(r.data=r.data.concat(i.data)),o.data&&(r.data=r.data.concat(o.data)),a.data&&(r.data=r.data.concat(a.data)),{data:r.data,state:e.LoadingState.Done,key:t.requestId}}))}backendQuery(e){var t=this;return zt((function*(){const{intervalMs:r,maxDataPoints:i,range:o,requestId:a}=e,s=e.targets.filter(t.isBackendTarget);e.scopedVars=Object.assign({},e.scopedVars,R(e.range));const l=n().compact(s.map((n=>n.hide?null:(t.replaceTargetVariables(n,e),Ut(Gt({},n),{datasourceId:t.datasourceId,intervalMs:r,maxDataPoints:i})))));if(!l.length)return Promise.resolve({data:[]});const u={queries:l};let c;o&&(u.range=o,u.from=o.from.valueOf().toString(),u.to=o.to.valueOf().toString());try{c=yield(0,re.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",data:u,requestId:a}).toPromise()}catch(e){return(0,re.toDataQueryResponse)(e)}const p=(0,re.toDataQueryResponse)(c);return t.sortByRefId(p),t.applyFrontendFunctions(p,e),De(p),Se(p.data)&&(console.log("Converting response to the wide format"),p.data=Pe(p.data)),p}))()}frontendQuery(t){var r=this;return zt((function*(){const i=t.targets.filter((e=>!(r.isBackendTarget(e)||r.isDBConnectionTarget(e)))),o=n().map(i,(e=>{if(e.hide)return[];t.scopedVars=Object.assign({},t.scopedVars,R(t.range)),r.replaceTargetVariables(e,t);const n=r.buildTimeRange(t,e);return e.queryType===p?e.group&&e.host&&e.item?r.queryTextData(e,n):[]:e.queryType===c?r.queryITServiceData(e,n,t):e.queryType===m?r.queryTriggersData(e,n,t):e.queryType===h?r.queryProblems(e,n,t):e.queryType===v?r.queryUserMacrosData(e):[]}));return Promise.all(n().flatten(o)).then(n().flatten).then((t=>(t&&t.length>0&&(0,e.isDataFrame)(t[0])&&!function(t){return t.fields.length&&t.fields[0].type===e.FieldType.other&&"problems"===t.fields[0].config.custom.type}(t[0])&&!function(e){return"macros"===e.name}(t[0])&&!function(t){return!t.fields.find((t=>t.type===e.FieldType.time||t.name===e.TIME_SERIES_TIME_FIELD_NAME))}(t[0])&&(t=Ae(t),Se(t)&&(console.log("Converting response to the wide format"),t=Pe(t))),{data:t})))}))()}dbConnectionQuery(e){var t=this;return zt((function*(){const r=e.targets.filter(t.isDBConnectionTarget),i=n().compact(r.map((n=>{if(n.hide)return[];e.scopedVars=Object.assign({},e.scopedVars,R(e.range)),t.replaceTargetVariables(n,e);const r=t.buildTimeRange(e,n),i=t.isUseTrends(r,n);return n.queryType&&n.queryType!==u?n.queryType===d&&n.itemids?t.queryItemIdData(n,r,i,e):[]:t.queryNumericData(n,r,i,e)})));return Promise.all(i).then(n().flatten).then((e=>({data:e})))}))()}buildTimeRange(e,t){let n=Math.ceil(a.parse(e.range.from)/1e3),r=Math.ceil(a.parse(e.range.to)/1e3);const i=Xt(t.functions,"Time");if(i.length){const[e,t]=k(i)([n,r]);n=e,r=t}return[n,r]}queryNumericData(e,t,n,r){var i=this;return zt((function*(){const o=yield i.zabbix.getItemsFromTarget(e,{itemtype:"num"}),a=(new Date).getTime(),s=yield i.queryNumericDataForItems(o,e,t,n,r),l=(new Date).getTime();return i.enableDebugLog&&console.log(`Datasource::Performance Query Time (${i.name}): ${l-a}`),i.handleBackendPostProcessingResponse(s,r,e)}))()}queryNumericDataForItems(e,t,r,i,o){var a=this;return zt((function*(){let s;o.valueType=a.getTrendValueType(t),o.consolidateBy=function(e){let t;const r=n().find(e.functions,(e=>"consolidateBy"===e.def.name));return r&&r.params&&r.params.length&&(t=r.params[0]),t}(t)||o.valueType,s=i?yield a.zabbix.getTrends(e,r,o):yield a.zabbix.getHistoryTS(e,r,o);const l={from:r[0],to:r[1]};return yield a.invokeDataProcessingQuery(s,t,l)}))()}invokeDataProcessingQuery(e,t,n){var r=this;return zt((function*(){const i={url:`/api/datasources/${r.datasourceId}/resources/db-connection-post`,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{series:e,query:t,timeRange:n}};return(yield(0,re.getBackendSrv)().fetch(i).toPromise()).data}))()}handleBackendPostProcessingResponse(t,n,r){const i=[];for(const n of t){const t=(0,e.dataFrameFromJSON)(n);t.refId=r.refId,i.push(t)}const o={data:i};return this.sortByRefId(o),this.applyFrontendFunctions(o,n),Se(o.data)&&(console.log("Converting response to the wide format"),o.data=Pe(o.data)),o.data}getTrendValueType(e){const t=n().map(ne().Trends,"name"),r=n().find(e.functions,(e=>n().includes(t,e.def.name)));return r?r.params[0]:"avg"}sortByRefId(e){e.data.sort(((e,t)=>e.refId<t.refId?-1:e.refId>t.refId?1:0))}applyFrontendFunctions(e,t){for(let n=0;n<e.data.length;n++){const r=e.data[n];k(Xt(en(t,r.refId).functions,"Alias"))(r)}return e}queryTextData(t,n){return this.zabbix.getItemsFromTarget(t,{itemtype:"text"}).then((e=>this.zabbix.getHistoryText(e,n,t))).then((n=>"table"!==t.resultFormat?n.map((n=>Te(n,t,[],e.FieldType.string))):n))}queryItemIdData(e,t,r,i){let o=e.itemids;return o=(0,re.getTemplateSrv)().replace(o,i.scopedVars,Jt),o=n().map(o.split(","),(e=>e.trim())),o?this.zabbix.getItemsByIDs(o).then((n=>this.queryNumericDataForItems(n,e,t,r,i))):[]}queryITServiceData(e,t,r){var i=this;return zt((function*(){if(e.hide||!e.itservice&&!e.itServiceFilter||!e.slaProperty)return[];let o;r.isOldVersion=e.itservice&&!e.itServiceFilter,o=r.isOldVersion?"/.*/":i.replaceTemplateVars(e.itServiceFilter,r.scopedVars),r.slaInterval=e.slaInterval;let a=yield i.zabbix.getITServices(o);var s;if(r.isOldVersion&&(a=n().filter(a,{serviceid:null===(s=e.itservice)||void 0===s?void 0:s.serviceid})),void 0!==e.slaFilter){const n=i.replaceTemplateVars(e.slaFilter,r.scopedVars),o=yield i.zabbix.getSLAs(n);return yield i.zabbix.getSLI(a,o,t,e,r)}const l=yield i.zabbix.getSLA(a,t,e,r),u=Oe(l,e.slaInterval),c=yield i.invokeDataProcessingQuery(u,e,{});return i.handleBackendPostProcessingResponse(c,r,e)}))()}queryUserMacrosData(e){var t=this;return zt((function*(){const r=e.group.filter,i=e.host.filter,o=e.macro.filter,a=yield t.zabbix.getUMacros(r,i,o),s=n().map(a,"hostmacroid"),l=yield t.zabbix.getUserMacros(s);return ye(l,e)}))()}queryTriggersData(e,t,n){var r=this;return zt((function*(){var i;if("items"===e.countTriggersBy)return r.queryTriggersICData(e,t);if("problems"===e.countTriggersBy)return r.queryTriggersPCData(e,t,n);const[o,a]=yield r.zabbix.getHostsApsFromTarget(e);if(!o.length)return Promise.resolve([]);const s=e.group.filter,l=yield r.zabbix.getGroups(s),u=null==o?void 0:o.map((e=>e.hostid)),c=null==a?void 0:a.map((e=>e.applicationid)),p=tn(e,t),d=_(r.replaceTemplateVars(null===(i=e.tags)||void 0===i?void 0:i.filter,n.scopedVars).replace("/^","").replace("$/",""));d.forEach((e=>{e.operator=1})),d&&d.length&&(p.tags=d);const m=yield r.zabbix.getHostAlerts(u,c,p);return Ie(m,l,t,e)}))()}queryTriggersICData(e,t){var n=this;return zt((function*(){const[r,i,o]=yield n.zabbix.getHostsFromICTarget(e,{itemtype:"num"});if(!r.length)return Promise.resolve([]);const a=e.group.filter,s=yield n.zabbix.getGroups(a),l=null==r?void 0:r.map((e=>e.hostid)),u=null==i?void 0:i.map((e=>e.applicationid)),c=null==o?void 0:o.map((e=>e.itemid));if(!c.length)return Promise.resolve([]);const p=tn(e,t),d=yield n.zabbix.getHostICAlerts(l,u,c,p);return Ie(d,s,t,e)}))()}queryTriggersPCData(e,t,n){var r=this;return zt((function*(){var i,o,a,s,l,u,c,p;const[d,m]=t,h=_(r.replaceTemplateVars(null===(i=e.tags)||void 0===i?void 0:i.filter,n.scopedVars).replace("/^","").replace("$/",""));h.forEach((e=>{e.operator=1}));const g={minSeverity:null===(o=e.options)||void 0===o?void 0:o.minSeverity,limit:null===(a=e.options)||void 0===a?void 0:a.limit};var f;if(h&&h.length&&(g.tags=h),(0===(null===(s=e.options)||void 0===s?void 0:s.acknowledged)||1===(null===(l=e.options)||void 0===l?void 0:l.acknowledged))&&(g.acknowledged=!!(null===(f=e.options)||void 0===f?void 0:f.acknowledged)),null===(u=e.options)||void 0===u?void 0:u.minSeverity){var v;let t=[0,1,2,3,4,5].filter((t=>{var n;return t>=(null===(n=e.options)||void 0===n?void 0:n.minSeverity)}));(null===(v=e.options)||void 0===v?void 0:v.severities)&&(t=t.filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}))),g.severities=t}e.options.useTimeRange&&(g.timeFrom=d,g.timeTo=m);const[y,b,E]=yield r.zabbix.getHostsFromPCTarget(e,g);if(!y.length)return Promise.resolve([]);const I=e.group.filter,w=yield r.zabbix.getGroups(I),T=null==y?void 0:y.map((e=>e.hostid)),x=null==b?void 0:b.map((e=>e.applicationid)),O=E.map((e=>e.triggerid)),S={minSeverity:null===(c=e.options)||void 0===c?void 0:c.minSeverity,acknowledged:null===(p=e.options)||void 0===p?void 0:p.acknowledged,count:e.options.count};e.options.useTimeRange&&(S.timeFrom=d,S.timeTo=m);const P=yield r.zabbix.getHostPCAlerts(T,x,O,S);return Ie(P,w,t,e)}))()}queryProblems(e,t,r){var i=this;return zt((function*(){var a,s,l,u,c,p,d,m,h,g,f,v,y;const[b,E]=t,w=o.contextSrv.isEditor||o.contextSrv.isGrafanaAdmin;let T=!0;const x=e.showProblems||I.Problems,O=e.options.hostProxy?i.zabbix.getProxies():()=>[];T=!i.disableReadOnlyUsersAck||w;const S=i.replaceTemplateVars(null===(a=e.group)||void 0===a?void 0:a.filter,r.scopedVars),P=i.replaceTemplateVars(null===(s=e.host)||void 0===s?void 0:s.filter,r.scopedVars),A=i.replaceTemplateVars(null===(l=e.application)||void 0===l?void 0:l.filter,r.scopedVars),D=i.replaceTemplateVars(null===(u=e.proxy)||void 0===u?void 0:u.filter,r.scopedVars),C=i.replaceTemplateVars(null===(c=e.trigger)||void 0===c?void 0:c.filter,r.scopedVars),R=i.replaceTemplateVars(null===(p=e.tags)||void 0===p?void 0:p.filter,r.scopedVars),F=Ut(Gt({},e),{trigger:{filter:C},tags:{filter:R}}),$=_(R.replace("/^","").replace("$/",""));$.forEach((e=>{e.operator=1}));const j={recent:x===I.Recent,minSeverity:null===(d=e.options)||void 0===d?void 0:d.minSeverity,limit:null===(m=e.options)||void 0===m?void 0:m.limit};var N;if($&&$.length&&(j.tags=$),(null==e?void 0:e.evaltype)&&(j.evaltype=null==e?void 0:e.evaltype),(0===(null===(h=e.options)||void 0===h?void 0:h.acknowledged)||1===(null===(g=e.options)||void 0===g?void 0:g.acknowledged))&&(j.acknowledged=!!(null===(N=e.options)||void 0===N?void 0:N.acknowledged)),null===(f=e.options)||void 0===f||null===(v=f.severities)||void 0===v?void 0:v.length){let t=[0,1,2,3,4,5].filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}));j.severities=t}let k;x===I.History||(null===(y=e.options)||void 0===y?void 0:y.useTimeRange)?(j.timeFrom=b,j.timeTo=E,k=i.zabbix.getProblemsHistory(S,P,A,D,j)):k=i.zabbix.getProblems(S,P,A,D,j);const L=i.zabbix.getUsers();let M,V;return Promise.all([k,O,L]).then((([e,t,r])=>(V=n().keyBy(r,"userid"),M=n().keyBy(t,"proxyid"),e))).then((e=>Ne(e))).then((e=>ke(e,T))).then((e=>Le(e,F))).then((t=>_e(t,e))).then((t=>Fe(t,e))).then((e=>je(e,V))).then((e=>$e(e,M))).then((t=>Me(t,e)))}))()}testDatasource(){var e=this;return zt((function*(){try{const{zabbixVersion:t,dbConnectorStatus:n}=yield e.zabbix.testDataSource();let r=`Zabbix API version: ${t}`;return n&&(r+=`, DB connector type: ${n.dsType}`),{status:"success",title:"Success",message:r}}catch(e){return e instanceof class{toString(){return this.name+" "+this.data}constructor(e){this.code=e.code||null,this.name=e.message||"",this.data=e.data||"",this.message="Zabbix API Error: "+this.name+" "+this.data}}?{status:"error",title:e.message,message:e.message}:e.data&&e.data.message?{status:"error",title:"Zabbix Client Error",message:e.data.message}:"string"==typeof e?{status:"error",title:"Unknown Error",message:e}:(console.log(e),{status:"error",title:"Connection failed",message:"Could not connect to given url"})}}))()}metricFindQuery(e,t){let r,i=n().cloneDeep(e);if(!e)return Promise.resolve([]);"string"==typeof e&&(i=A(e));for(const e of["group","host","application","itemTag","item"])i[e]=this.replaceTemplateVars(i[e],{});const{group:o,host:a,application:s,item:l}=i;switch(i.queryType){case E.Group:r=this.zabbix.getGroups(i.group);break;case E.Host:r=this.zabbix.getHosts(i.group,i.host);break;case E.Application:r=this.zabbix.getApps(i.group,i.host,i.application);break;case E.ItemTag:r=this.zabbix.getItemTags(i.group,i.host,i.itemTag);break;case E.Item:r=this.zabbix.getItems(i.group,i.host,i.application,null,i.item);break;case E.ItemValues:const e=null==t?void 0:t.range;r=this.zabbix.getItemValues(o,a,s,l,{range:e});break;default:r=Promise.resolve([])}return r.then((e=>n().map(e,Zt)))}targetContainsTemplate(e){var t,n,r,i,o,a,s,l;const u=(0,re.getTemplateSrv)();return u.variableExists(null===(t=e.group)||void 0===t?void 0:t.filter)||u.variableExists(null===(n=e.host)||void 0===n?void 0:n.filter)||u.variableExists(null===(r=e.application)||void 0===r?void 0:r.filter)||u.variableExists(null===(i=e.itemTag)||void 0===i?void 0:i.filter)||u.variableExists(null===(o=e.item)||void 0===o?void 0:o.filter)||u.variableExists(null===(a=e.macro)||void 0===a?void 0:a.filter)||u.variableExists(null===(s=e.proxy)||void 0===s?void 0:s.filter)||u.variableExists(null===(l=e.trigger)||void 0===l?void 0:l.filter)||u.variableExists(e.textFilter)||u.variableExists(e.itServiceFilter)}annotationRequest(t){var n=this;return zt((function*(){const r=t.targets.filter((e=>e.fromAnnotations));if(!r.length)return Promise.resolve({data:[]});const i=yield n.annotationQueryLegacy(Ut(Gt({},t),{targets:r}));return{data:[(0,e.toDataFrame)(i)]}}))()}annotationQueryLegacy(e){const t=e.range||e.rangeRaw,r=Math.ceil(a.parse(t.from)/1e3),i=Math.ceil(a.parse(t.to)/1e3),o=e.targets[0],s={value:o.options.showOkEvents?["0","1"]:"1",valueFromEvent:!0,timeFrom:r,timeTo:i};if(o.options.minSeverity){const e=[0,1,2,3,4,5].filter((e=>e>=Number(o.options.minSeverity)));s.severities=e}const u=this.replaceTemplateVars(o.group.filter,{}),c=this.replaceTemplateVars(o.host.filter,{}),p=this.replaceTemplateVars(o.application.filter,{});return this.zabbix.getProblemsHistory(u,c,p,void 0,s).then((e=>{const t=this.replaceTemplateVars(o.trigger.filter,{});return C(t)?e=n().filter(e,(e=>F(t).test(e.description))):t&&(e=n().filter(e,(e=>e.description===t))),o.hideAcknowledged&&(e=n().filter(e,(e=>{var t;return!(null===(t=e.acknowledges)||void 0===t?void 0:t.length)}))),n().map(e,(e=>{const t=function(e){if(e.length){let t="<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td><td><b>User</b></td><td><b>Comments</b></td></tr>";return n().each(n().map(e,(e=>"<tr><td><i>"+l().unix(e.clock).format("DD MMM YYYY HH:mm:ss")+"</i></td><td>"+e.alias+" ("+e.name+" "+e.surname+")</td><td>"+e.message+"</td></tr>")),(e=>{t=t.concat(e)})),t=t.concat("</table>"),t}return""}(e.acknowledges);let r=[];return o.showHostname&&(r=n().map(e.hosts,"name")),{title:"1"===e.value?"Problem":"OK",time:1e3*e.timestamp,annotation:o,text:e.name+t,tags:r}}))}))}replaceTargetVariables(e,t){const r=(0,re.getTemplateSrv)();n().forEach(["group","host","application","itemTag","item"],(n=>{e[n]&&e[n].filter&&(e[n].filter=this.replaceTemplateVars(e[n].filter,t.scopedVars))})),e.textFilter&&(e.textFilter=this.replaceTemplateVars(e.textFilter,t.scopedVars)),e.itemids&&(e.itemids=r.replace(e.itemids,t.scopedVars,Jt)),n().forEach(e.functions,(e=>{e.params=n().map(e.params,(e=>"number"==typeof e?+r.replace(e.toString(),t.scopedVars):r.replace(e,t.scopedVars)))}))}isUseTrends(e,t){if("false"===t.options.useTrends)return!1;const[n,r]=e,i=Math.ceil(a.parse("now-"+this.trendsFrom)/1e3),o=Math.ceil(N(this.trendsRange)/1e3);return("true"===t.options.useTrends||this.trends)&&(n<i||r-n>o)}constructor(e){super(e),this.isBackendTarget=e=>!this.enableDirectDBConnection&&(e.queryType===u||e.queryType===d),this.isDBConnectionTarget=e=>this.enableDirectDBConnection&&(e.queryType===u||e.queryType===d),this.enableDebugLog="development"===i().buildInfo.env,this.annotations={QueryEditor:Bt,prepareAnnotation:Z};const t=(0,re.getTemplateSrv)();this.replaceTemplateVars=n().partial(Kt,t),this.datasourceId=e.id,this.name=e.name,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials;const r=function(e){if(e||(e={}),!function(e){return!(!e.dbConnection||n().isEmpty(e.dbConnection))||!!(e.schema&&e.schema<3)}(e))return e;const t=e.schema||1;if(e.schema=3,t<2){const t=e.dbConnection||{};e.dbConnectionEnable=t.enable||!1,e.dbConnectionDatasourceId=t.datasourceId||null,delete e.dbConnection}return t<3&&(e.timeout=""===e.timeout?null:Number(e.timeout)),e}(e.jsonData);this.trends=r.trends,this.trendsFrom=r.trendsFrom||"7d",this.trendsRange=r.trendsRange||"4d";const o=r.cacheTTL||"1h";this.cacheTTL=N(o),this.disableReadOnlyUsersAck=r.disableReadOnlyUsersAck,this.disableDataAlignment=r.disableDataAlignment,this.enableDirectDBConnection=r.dbConnectionEnable||!1,this.dbConnectionDatasourceId=r.dbConnectionDatasourceId,this.dbConnectionDatasourceName=r.dbConnectionDatasourceName,this.dbConnectionRetentionPolicy=r.dbConnectionRetentionPolicy;const a={basicAuth:this.basicAuth,withCredentials:this.withCredentials,cacheTTL:this.cacheTTL,enableDirectDBConnection:this.enableDirectDBConnection,dbConnectionDatasourceId:this.dbConnectionDatasourceId,dbConnectionDatasourceName:this.dbConnectionDatasourceName,dbConnectionRetentionPolicy:this.dbConnectionRetentionPolicy,datasourceId:this.datasourceId};this.zabbix=new yt(a)}}function Xt(e,t){const r=n().map(ne()[t],"name"),i=n().filter(e,(e=>n().includes(r,e.def.name)));return n().map(i,(e=>te(e.def,e.params).bindFunction(ae.metricFunctions)))}function Zt(e){return{text:e.name,expandable:!1}}function Yt(e){return"string"==typeof e?$(e):"("+n().map(e,$).join("|")+")"}function Jt(e){return"string"==typeof e?e:e.join(",")}function Kt(e,t,n){let r=e.replace(t,n,Yt);return t&&t!==r&&!C(r)&&(r="/^"+r+"$/"),r}function en(e,t){for(let n=0;n<e.targets.length;n++){const r=e.targets[n];if(r.refId===t)return r}return null}const tn=(e,t)=>{var n,r,i,o;const[a,s]=t,l={minSeverity:null===(n=e.options)||void 0===n?void 0:n.minSeverity,acknowledged:null===(r=e.options)||void 0===r?void 0:r.acknowledged,count:null===(i=e.options)||void 0===i?void 0:i.count};return(null===(o=e.options)||void 0===o?void 0:o.useTimeRange)&&(l.timeFrom=a,l.timeTo=s),l};function nn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function rn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){nn(o,r,i,a,s,"next",e)}function s(e){nn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const an=({query:e,datasource:t,onChange:r})=>{var i,o,a,s;const l=(u=rn((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return u.apply(this,arguments)});var u;const[{loading:c,value:p},d]=Ot(rn((function*(){return yield l()})),[]),m=function(){var e=rn((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=Ot(rn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=rn((function*(e,r){const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllApps(i,o);let s=null==a?void 0:a.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:y,value:b},E]=Ot(rn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),I=function(){var e=rn((function*(e,r){if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllItems(i,o,null,null,{}),s=n().flatten(a.map((e=>e.tags||[]))),l=n().uniqBy(s,(e=>e.tag+e.value||"")).map((e=>V(e)));let u=null==l?void 0:l.map((e=>({value:e,label:e})));return u=n().uniqBy(u,(e=>e.value)),u.unshift(...Nt()),u}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:T},x]=Ot(rn((function*(){return yield I(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),O=function(){var r=rn((function*(r,i,o,a){const s=t.replaceTemplateVars(r),l=t.replaceTemplateVars(i),u=t.replaceTemplateVars(o),c=t.replaceTemplateVars(a),p={itemtype:"num",showDisabledItems:e.options.showDisabledItems},d=yield t.zabbix.getAllItems(s,l,u,c,p);let m=null==d?void 0:d.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Nt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:S,value:P},A]=Ot(rn((function*(){return yield O(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),D=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),C=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),R=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),F=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,wt.useEffect)((()=>{d()}),[]),(0,wt.useEffect)((()=>{f()}),[D]),(0,wt.useEffect)((()=>{E()}),[D,C]),(0,wt.useEffect)((()=>{x()}),[D,C]),(0,wt.useEffect)((()=>{A()}),[D,C,R,F]);const $=t=>n=>{var i,o;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){on(e,t,n[t])}))}return e}({},e),o=null!=(o={[t]:{filter:n}})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})),i))},j=t.zabbix.supportsApplications();return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:e.group.filter,options:p,isLoading:c,onChange:$("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:$("host")}))),Tt().createElement(Pt,null,j&&Tt().createElement(St.InlineField,{label:"Application",labelWidth:12},Tt().createElement($t,{width:24,value:e.application.filter,options:b,isLoading:y,onChange:$("application")})),!j&&Tt().createElement(St.InlineField,{label:"Item tag",labelWidth:12},Tt().createElement($t,{width:24,value:e.itemTag.filter,options:T,isLoading:w,onChange:$("itemTag")})),Tt().createElement(St.InlineField,{label:"Item",labelWidth:12},Tt().createElement($t,{width:24,value:e.item.filter,options:P,isLoading:S,onChange:$("item")}))))},sn=e=>Tt().createElement(St.Icon,{className:"pointer",name:"question-circle",onClick:()=>{window.open(`https://alexanderzobnin.github.io/grafana-zabbix/reference/functions/#${e.name}`,"_blank")}}),ln=e=>{const{func:t,onMoveLeft:n,onMoveRight:r,onRemove:i}=e;return Tt().createElement("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"}},Tt().createElement(St.Icon,{className:"pointer",name:"arrow-left",onClick:()=>n(t)}),Tt().createElement(sn,{name:t.def.name,description:t.def.description}),Tt().createElement(St.Icon,{className:"pointer",name:"times",onClick:()=>i(t)}),Tt().createElement(St.Icon,{className:"pointer",name:"arrow-right",onClick:()=>r(t)}))};function un(){return un=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},un.apply(this,arguments)}const cn=e=>({icon:At.css`
      margin-right: ${e.spacing(.5)};
    `,label:(0,At.css)({fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.bodySmall.fontSize,cursor:"pointer",display:"inline-block"})}),pn=e=>{var{onMoveLeft:t,onMoveRight:n,func:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["onMoveLeft","onMoveRight","func"]);const o=(0,St.useStyles2)(cn);return Tt().createElement(St.Tooltip,{content:({updatePopperPosition:e})=>Tt().createElement(ln,un({},i,{func:r,onMoveLeft:()=>{t(r),e()},onMoveRight:()=>{n(r),e()}})),placement:"top",interactive:!0},Tt().createElement("span",{className:o.label},r.def.name))};function dn({editableParam:e,onChange:t,onExpandedChange:n,autofocus:r}){var i;const o=(0,St.useStyles2)(mn);return(null===(i=e.options)||void 0===i?void 0:i.length)>0?Tt().createElement(St.Segment,{autofocus:r,value:e.value,inputPlaceholder:e.name,className:o.segment,options:e.options,placeholder:" +"+e.name,onChange:e=>{t(e.value||"")},onExpandedChange:n,inputMinWidth:150,allowCustomValue:!0,allowEmptyValue:!0}):Tt().createElement(St.SegmentInput,{autofocus:r,className:o.input,value:e.value||"",placeholder:" +"+e.name,inputPlaceholder:e.name,onChange:e=>{t(e.toString())},onExpandedChange:n,style:{height:"25px",paddingTop:"2px",marginTop:"2px",paddingLeft:"4px",minWidth:"100px"}})}const mn=e=>({segment:(0,At.css)({margin:0,padding:0}),input:At.css`
    margin: 0;
    padding: 0;
    input {
      height: 25px;
    },
  `});function hn(e,t,n){var r,i;return{name:e.name,value:(null==n?void 0:n.toString())||"",optional:!!e.optional||t,multiple:!!e.multiple,options:null!==(i=null===(r=e.options)||void 0===r?void 0:r.map((e=>({value:e.toString(),label:e.toString()}))))&&void 0!==i?i:[]}}function gn({func:e,onMoveLeft:t,onMoveRight:n,onRemove:r,onParamChange:i}){const o=(0,St.useStyles2)(fn),[a,s]=(0,wt.useState)(!1),[l,u]=(0,wt.useState)(!1);let c=function(e){var t;const n=e.def.params.map(((t,n)=>hn(t,!1,e.params[n])));for(;n.length<e.params.length;){const t=e.def.params[e.def.params.length-1],r=e.params[n.length];n.push(hn(t,!0,r))}if(n.length&&n[n.length-1].value&&(null===(t=n[n.length-1])||void 0===t?void 0:t.multiple)){const t=e.def.params[e.def.params.length-1];n.push(hn(t,!0,""))}return n}(e);return c=c.filter(((t,n)=>n<e.def.params.length&&!t.optional||e.added||t.value||l||a)),Tt().createElement("div",{className:(0,At.cx)(o.container),onMouseOver:()=>s(!0),onMouseLeave:()=>s(!1)},Tt().createElement(St.HorizontalGroup,{spacing:"none"},Tt().createElement(pn,{func:e,onMoveLeft:t,onMoveRight:n,onRemove:r}),Tt().createElement(St.InlineLabel,{className:o.label},"("),c.map(((t,n)=>Tt().createElement(Tt().Fragment,{key:n},Tt().createElement(dn,{autofocus:0===n&&e.added,editableParam:t,onChange:r=>{(""!==r||t.optional)&&i(e,n,r),u(!1),s(!1)},onExpandedChange:u}),n!==c.length-1?",":""))),Tt().createElement(St.InlineLabel,{className:o.label},")")))}const fn=e=>({container:(0,At.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`}),error:At.css`
    border: 1px solid ${e.colors.error.main};
  `,label:(0,At.css)({padding:0,margin:0}),button:(0,At.css)({padding:e.spacing(.5)})});function vn({onFuncAdd:e}){const[t,n]=(0,wt.useState)(!1),r=(0,St.useStyles2)(yn),i=(0,St.useTheme2)(),o=t=>{e(t),n(!1)},a=(0,wt.useMemo)((()=>function(e){const t=ne(),n=[];for(const r in t){const i=t[r].map((t=>Tt().createElement(St.Menu.Item,{label:t.name,key:t.name,onClick:()=>e(t)})));n.push(Tt().createElement(St.Menu.Item,{label:r,key:r,childItems:i}))}return n}(o)),[e]);return Tt().createElement("div",null,!t&&Tt().createElement(St.Button,{icon:"plus",variant:"secondary",className:(0,At.cx)(r.button),"aria-label":"Add new function",onClick:()=>n(!t)}),t&&Tt().createElement(St.ClickOutsideWrapper,{onClick:()=>{n(!1)},useCapture:!0},Tt().createElement(St.Input,{onChange:e=>{console.log(e.currentTarget.value)},suffix:Tt().createElement(St.Icon,{name:"search"})}),Tt().createElement(St.Menu,{style:{position:"absolute",zIndex:i.zIndex.dropdown}},a)))}function yn(e){return{button:At.css`
      margin-right: ${e.spacing(.5)};
    `}}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function En(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bn(e,t,n[t])}))}return e}function In(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const wn=({query:e,onChange:t})=>{var n;const r=(n,r,i)=>{n.params[r]=i;const o=e.functions.findIndex((e=>e===n)),a=e.functions;a[o]=n,t(In(En({},e),{functions:a}))},i=n=>{const r=e.functions.indexOf(n),i=W(e.functions,r,r-1);t(In(En({},e),{functions:i}))},o=n=>{const r=e.functions.indexOf(n),i=W(e.functions,r,r+1);t(In(En({},e),{functions:i}))},a=n=>{var r;const i=null===(r=e.functions)||void 0===r?void 0:r.filter((e=>e!==n));t(In(En({},e),{functions:i}))};return Tt().createElement(Pt,null,Tt().createElement(St.InlineFormLabel,{width:6},"Functions"),null===(n=e.functions)||void 0===n?void 0:n.map(((e,t)=>Tt().createElement(gn,{func:e,key:t,onParamChange:r,onMoveLeft:i,onMoveRight:o,onRemove:a}))),Tt().createElement(vn,{onFuncAdd:n=>{const r=te(n);r.added=!0;let i=e.functions.concat(r);i=function(e){const t=e.findIndex((e=>"Alias"===e.def.category));if(console.log(t),t>=0){const n=e[t];e.splice(t,1),e.push(n)}return e}(i),t(In(En({},e),{functions:i}))}}))};function Tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Tn(e,t,n[t])}))}return e}function On(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Sn=[{label:"all triggers",value:2},{label:"unacknowledged",value:0},{label:"acknowledged",value:1}],Pn=[{label:"Default",value:"default"},{label:"Last change",value:"lastchange"},{label:"Severity",value:"severity"}],An=[{label:"Default",value:"default"},{label:"True",value:"true"},{label:"False",value:"false"}],Dn=({queryType:e,queryOptions:t,onChange:n})=>{const[r,i]=(0,wt.useState)(!1),o=(0,St.useStyles2)(Cn),a=e=>{var r;const i=Number(null==e||null===(r=e.currentTarget)||void 0===r?void 0:r.value);null!==i&&n(On(xn({},t),{limit:i}))},s=e=>r=>{null!==r.value&&n(On(xn({},t),{[e]:r.value}))},l=()=>Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Trends",labelWidth:24},Tt().createElement(St.Select,{isSearchable:!1,width:16,value:t.useTrends,options:An,onChange:s("useTrends")})),Tt().createElement(St.InlineField,{label:"Show disabled items",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(On(xn({},t),{showDisabledItems:!t.showDisabledItems}))})),Tt().createElement(St.InlineField,{label:"Use Zabbix value mapping",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.useZabbixValueMapping,onChange:()=>n(On(xn({},t),{useZabbixValueMapping:!t.useZabbixValueMapping}))})),Tt().createElement(St.InlineField,{label:"Disable data alignment",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.disableDataAlignment,onChange:()=>n(On(xn({},t),{disableDataAlignment:!t.disableDataAlignment}))})));return Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineFieldRow,null,Tt().createElement("div",{className:o.container,onClick:()=>i(!r)},Tt().createElement(Tt().Fragment,null,Tt().createElement(St.HorizontalGroup,null,!r&&Tt().createElement(St.Icon,{name:"angle-right"}),r&&Tt().createElement(St.Icon,{name:"angle-down"}),Tt().createElement("span",{className:o.label},"Options"),Tt().createElement("div",{className:o.options},(()=>{const e=[];for(const n in t)if(t.hasOwnProperty(n)){const r=t[n];!0===r&&""!==r&&null!=r&&e.push(Tt().createElement("span",{className:o.optionContainer,key:n},`${n} = ${r}`))}return e})()))))),Tt().createElement(St.InlineFieldRow,null,r&&Tt().createElement("div",{className:o.editorContainer},e===u&&l(),e===d&&l(),e===c&&l(),e===p&&Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Show disabled items",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(On(xn({},t),{showDisabledItems:!t.showDisabledItems}))}))),e===h&&Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Acknowledged",labelWidth:24},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:Sn,onChange:s("acknowledged")})),Tt().createElement(St.InlineField,{label:"Sort by",labelWidth:24},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:t.sortProblems,options:Pn,onChange:s("sortProblems")})),Tt().createElement(St.InlineField,{label:"Use time range",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(On(xn({},t),{useTimeRange:!t.useTimeRange}))})),Tt().createElement(St.InlineField,{label:"Hosts in maintenance",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.hostsInMaintenance,onChange:()=>n(On(xn({},t),{hostsInMaintenance:!t.hostsInMaintenance}))})),Tt().createElement(St.InlineField,{label:"Host proxy",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.hostProxy,onChange:()=>n(On(xn({},t),{hostProxy:!t.hostProxy}))})),Tt().createElement(St.InlineField,{label:"Limit",labelWidth:24},Tt().createElement(St.Input,{width:12,type:"number",defaultValue:t.limit,onBlur:a}))),e===m&&Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Acknowledged",labelWidth:24},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:Sn,onChange:s("acknowledged")})),Tt().createElement(St.InlineField,{label:"Use time range",labelWidth:24},Tt().createElement(St.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(On(xn({},t),{useTimeRange:!t.useTimeRange}))}))))))},Cn=e=>({container:(0,At.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),marginBottom:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`,width:"100%"}),label:(0,At.css)({color:e.colors.info.text,fontWeight:e.typography.fontWeightMedium,cursor:"pointer"}),options:(0,At.css)({color:e.colors.text.disabled,fontSize:e.typography.bodySmall.fontSize}),optionContainer:At.css`
    margin-right: ${e.spacing(2)};
  `,editorContainer:At.css`
    display: flex;
    flex-direction: column;
    margin-left: ${e.spacing(4)};
  `});function Rn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Fn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Rn(o,r,i,a,s,"next",e)}function s(e){Rn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function $n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$n(e,t,n[t])}))}return e}function Nn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const kn=({query:e,datasource:t,onChange:r})=>{var i,o,a,s;const l=(u=Fn((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return u.apply(this,arguments)});var u;const[{loading:c,value:p},d]=Ot(Fn((function*(){return yield l()})),[]),m=function(){var e=Fn((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=Ot(Fn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=Fn((function*(e,r){const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllApps(i,o);let s=null==a?void 0:a.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:y,value:b},E]=Ot(Fn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),I=function(){var r=Fn((function*(r,i,o,a){const s=t.replaceTemplateVars(r),l=t.replaceTemplateVars(i),u=t.replaceTemplateVars(o),c=t.replaceTemplateVars(a),p={itemtype:"text",showDisabledItems:e.options.showDisabledItems},d=yield t.zabbix.getAllItems(s,l,u,c,p);let m=null==d?void 0:d.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Nt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:w,value:T},x]=Ot(Fn((function*(){return yield I(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),O=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),S=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),P=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),A=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,wt.useEffect)((()=>{d()}),[]),(0,wt.useEffect)((()=>{f()}),[O]),(0,wt.useEffect)((()=>{E()}),[O,S]),(0,wt.useEffect)((()=>{x()}),[O,S,P,A]);const D=t=>n=>{null!==n&&r(Nn(jn({},e),{[t]:{filter:n}}))};return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:e.group.filter,options:p,isLoading:c,onChange:D("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:D("host")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Application",labelWidth:12},Tt().createElement($t,{width:24,value:e.application.filter,options:b,isLoading:y,onChange:D("application")})),Tt().createElement(St.InlineField,{label:"Item",labelWidth:12},Tt().createElement($t,{width:24,value:e.item.filter,options:T,isLoading:w,onChange:D("item")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Text filter",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:e.textFilter,onBlur:t=>{var n;const i=null==t||null===(n=t.currentTarget)||void 0===n?void 0:n.value;null!==i&&r(Nn(jn({},e),{textFilter:i}))}})),Tt().createElement(St.InlineField,{label:"Use capture groups",labelWidth:18},Tt().createElement(St.InlineSwitch,{value:e.useCaptureGroups,onChange:()=>r(Nn(jn({},e),{useCaptureGroups:!e.useCaptureGroups}))}))))};function Ln(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function _n(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ln(o,r,i,a,s,"next",e)}function s(e){Ln(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Mn(e,t,n[t])}))}return e}function qn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Bn=[{label:"Problems",value:"problems"},{label:"Recent problems",value:"recent"},{label:"History",value:"history"}],Hn=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],zn=[{label:"AND/OR",value:T.AndOr},{label:"OR",value:T.Or}],Wn=({query:e,datasource:t,onChange:r})=>{var i,o,a,s,l,u,c,p,d;const m=(h=_n((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return h.apply(this,arguments)});var h;const[{loading:g,value:f},v]=Ot(_n((function*(){return yield m()})),[]),y=function(){var e=_n((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:b,value:E},I]=Ot(_n((function*(){return yield y(e.group.filter)})),[e.group.filter]),w=function(){var e=_n((function*(e,r){const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllApps(i,o);let s=null==a?void 0:a.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:T,value:x},O]=Ot(_n((function*(){return yield w(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),S=function(){var e=_n((function*(){const e=yield t.zabbix.getProxies(),n=null==e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Nt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:P,value:A},D]=Ot(_n((function*(){return yield S()})),[]),C=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),R=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter);(0,wt.useEffect)((()=>{v()}),[]),(0,wt.useEffect)((()=>{I()}),[C]),(0,wt.useEffect)((()=>{O()}),[C,R]),(0,wt.useEffect)((()=>{D()}),[]);const F=t=>n=>{var i;const o=null==n||null===(i=n.currentTarget)||void 0===i?void 0:i.value;null!==o&&r(qn(Vn({},e),{[t]:{filter:o}}))},$=t=>n=>{null!==n&&r(qn(Vn({},e),{[t]:{filter:n}}))},j=t=>n=>{null!==n.value&&r(qn(Vn({},e),{[t]:n.value}))},N=t.zabbix.supportsApplications();return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:null===(a=e.group)||void 0===a?void 0:a.filter,options:f,isLoading:g,onChange:$("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:null===(s=e.host)||void 0===s?void 0:s.filter,options:E,isLoading:b,onChange:$("host")})),Tt().createElement(St.InlineField,{label:"Proxy",labelWidth:12},Tt().createElement($t,{width:24,value:null===(l=e.proxy)||void 0===l?void 0:l.filter,options:A,isLoading:P,onChange:$("proxy")}))),Tt().createElement(Pt,null,N&&Tt().createElement(St.InlineField,{label:"Application",labelWidth:12},Tt().createElement($t,{width:24,value:null===(u=e.application)||void 0===u?void 0:u.filter,options:x,isLoading:T,onChange:$("application")})),Tt().createElement(St.InlineField,{label:"Problem",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:null===(c=e.trigger)||void 0===c?void 0:c.filter,placeholder:"Problem name",onBlur:F("trigger")})),Tt().createElement(St.InlineField,{label:"Tags",labelWidth:12},Tt().createElement(St.Input,{width:36,defaultValue:null===(p=e.tags)||void 0===p?void 0:p.filter,placeholder:"tag1:value1, tag2:value2",onBlur:F("tags")})),Tt().createElement(St.InlineField,null,Tt().createElement(St.Select,{isSearchable:!1,width:15,value:e.evaltype,options:zn,onChange:j("evaltype")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Show",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:e.showProblems,options:Bn,onChange:j("showProblems")})),Tt().createElement(St.InlineField,{label:"Severity",labelWidth:12},Tt().createElement(St.MultiSelect,{isSearchable:!1,isClearable:!0,placeholder:"Show all problems",value:null===(d=e.options)||void 0===d?void 0:d.severities,options:Hn,onChange:t=>{null!==t&&r(qn(Vn({},e),{options:qn(Vn({},e.options),{severities:t.map((e=>e.value))})}))}}))))};function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Un=({query:e,onChange:t})=>Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Item Ids",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:e.itemids,onBlur:n=>{var r;const i=null==n||null===(r=n.currentTarget)||void 0===r?void 0:r.value;var o,a;null!==i&&t((o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Gn(e,t,n[t])}))}return e}({},e),a=null!=(a={itemids:i})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(a)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})),o))}})));function Qn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Xn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Qn(o,r,i,a,s,"next",e)}function s(e){Qn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zn(e,t,n[t])}))}return e}function Jn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Kn=[{label:"Status",value:"status"},{label:"SLI",value:"sli"},{label:"Uptime",value:"uptime"},{label:"Downtime",value:"downtime"},{label:"Error budget",value:"error_budget"}],er=[{label:"No interval",value:"none"},{label:"Auto",value:"auto"},{label:"1 hour",value:"1h"},{label:"12 hours",value:"12h"},{label:"24 hours",value:"1d"},{label:"1 week",value:"1w"},{label:"1 month",value:"1M"}],tr=({query:e,datasource:t,onChange:n})=>{const r=(i=Xn((function*(){const e=yield t.zabbix.getITService(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return i.apply(this,arguments)});var i;const[{loading:o,value:a},s]=Ot(Xn((function*(){return yield r()})),[]),l=function(){var e=Xn((function*(){const e=yield t.zabbix.getSLAList(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:u,value:c},p]=Ot(Xn((function*(){return yield l()})),[]);(0,wt.useEffect)((()=>{s(),p()}),[]);const d=t=>r=>{r.value&&n(Jn(Yn({},e),{[t]:r.value}))},m=t=>r=>{void 0!==r&&n(Jn(Yn({},e),{[t]:r}))};return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Service",labelWidth:12},Tt().createElement($t,{width:24,value:e.itServiceFilter,options:a,isLoading:o,onChange:m("itServiceFilter")})),Tt().createElement(St.InlineField,{label:"SLA",labelWidth:12},Tt().createElement($t,{width:24,value:e.slaFilter,options:c,isLoading:u,onChange:m("slaFilter")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Property",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:e.slaProperty,options:Kn,onChange:d("slaProperty")})),Tt().createElement(St.InlineField,{label:"Interval",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:e.slaInterval,options:er,onChange:d("slaInterval")}))))};function nr(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function rr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){nr(o,r,i,a,s,"next",e)}function s(e){nr(o,r,i,a,s,"throw",e)}a(void 0)}))}}function ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ir(e,t,n[t])}))}return e}function ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const sr=[{value:"",label:"All triggers"},{value:"problems",label:"Problems"},{value:"items",label:"Items"}],lr=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],ur=({query:e,datasource:t,onChange:r})=>{var i,o,a,s,l,u,c,p,d,m,h,g;const f=(v=rr((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return v.apply(this,arguments)});var v;const[{loading:y,value:b},E]=Ot(rr((function*(){return yield f()})),[]),I=function(){var e=rr((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:w,value:T},x]=Ot(rr((function*(){return yield I(e.group.filter)})),[e.group.filter]),O=function(){var e=rr((function*(e,r){const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllApps(i,o);let s=null==a?void 0:a.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:S,value:P},A]=Ot(rr((function*(){return yield O(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),D=function(){var e=rr((function*(e,r){if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllItems(i,o,null,null,{}),s=n().flatten(a.map((e=>e.tags||[]))),l=n().uniqBy(s,(e=>e.tag+e.value||"")).map((e=>V(e)));let u=null==l?void 0:l.map((e=>({value:e,label:e})));return u=n().uniqBy(u,(e=>e.value)),u.unshift(...Nt()),u}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:C,value:R},F]=Ot(rr((function*(){return yield D(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),$=function(){var e=rr((function*(){const e=yield t.zabbix.getProxies(),n=null==e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Nt()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:j,value:N},k]=Ot(rr((function*(){return yield $()})),[]),L=function(){var r=rr((function*(r,i,o,a){const s=t.replaceTemplateVars(r),l=t.replaceTemplateVars(i),u=t.replaceTemplateVars(o),c=t.replaceTemplateVars(a),p={itemtype:"num",showDisabledItems:e.options.showDisabledItems},d=yield t.zabbix.getAllItems(s,l,u,c,p);let m=null==d?void 0:d.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Nt()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:_,value:M},q]=Ot(rr((function*(){return yield L(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),B=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),H=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),z=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),W=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,wt.useEffect)((()=>{E()}),[]),(0,wt.useEffect)((()=>{x()}),[B]),(0,wt.useEffect)((()=>{A()}),[B,H]),(0,wt.useEffect)((()=>{F()}),[B,H]),(0,wt.useEffect)((()=>{k()}),[]),(0,wt.useEffect)((()=>{q()}),[B,H,z,W]);const G=t=>n=>{var i;const o=null==n||null===(i=n.currentTarget)||void 0===i?void 0:i.value;null!==o&&r(ar(or({},e),{[t]:{filter:o}}))},U=t=>n=>{null!==n&&r(ar(or({},e),{[t]:{filter:n}}))},Q=t.zabbix.supportsApplications();return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Count by",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:e.countTriggersBy,options:sr,onChange:t=>{null!==t.value&&r(ar(or({},e),{countTriggersBy:t.value}))}}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:null===(l=e.group)||void 0===l?void 0:l.filter,options:b,isLoading:y,onChange:U("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:null===(u=e.host)||void 0===u?void 0:u.filter,options:T,isLoading:w,onChange:U("host")})),"problems"===e.countTriggersBy&&Tt().createElement(St.InlineField,{label:"Proxy",labelWidth:12},Tt().createElement($t,{width:24,value:null===(c=e.proxy)||void 0===c?void 0:c.filter,options:N,isLoading:j,onChange:U("proxy")}))),Tt().createElement(Pt,null,Q&&Tt().createElement(St.InlineField,{label:"Application",labelWidth:12},Tt().createElement($t,{width:24,value:null===(p=e.application)||void 0===p?void 0:p.filter,options:P,isLoading:S,onChange:U("application")})),!Q&&"items"===e.countTriggersBy&&Tt().createElement(St.InlineField,{label:"Item tag",labelWidth:12},Tt().createElement($t,{width:24,value:e.itemTag.filter,options:R,isLoading:C,onChange:U("itemTag")})),"problems"===e.countTriggersBy&&Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineField,{label:"Problem",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:null===(d=e.trigger)||void 0===d?void 0:d.filter,placeholder:"Problem name",onBlur:G("trigger")}))),"items"===e.countTriggersBy&&Tt().createElement(St.InlineField,{label:"Item",labelWidth:12},Tt().createElement($t,{width:24,value:e.item.filter,options:M,isLoading:_,onChange:U("item")})),!Q&&Tt().createElement(St.InlineField,{label:"Tags",labelWidth:12},Tt().createElement(St.Input,{width:24,defaultValue:null===(m=e.tags)||void 0===m?void 0:m.filter,placeholder:"tag1:value1, tag2:value2",onBlur:G("tags")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Min severity",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:null===(h=e.options)||void 0===h?void 0:h.minSeverity,options:lr,onChange:t=>{null!==t.value&&r(ar(or({},e),{options:ar(or({},e.options),{minSeverity:t.value})}))}})),Tt().createElement(St.InlineField,{label:"Count",labelWidth:12},Tt().createElement(St.InlineSwitch,{value:null===(g=e.options)||void 0===g?void 0:g.count,onChange:()=>{var t;return r(ar(or({},e),{options:ar(or({},e.options),{count:!(null===(t=e.options)||void 0===t?void 0:t.count)})}))}}))))};function cr(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function pr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){cr(o,r,i,a,s,"next",e)}function s(e){cr(o,r,i,a,s,"throw",e)}a(void 0)}))}}function dr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const mr=({query:e,datasource:t,onChange:r})=>{var i,o;const a=(s=pr((function*(){const e=yield t.zabbix.getAllGroups(),n=null==e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Nt()),n})),function(){return s.apply(this,arguments)});var s;const[{loading:l,value:u},c]=Ot(pr((function*(){return yield a()})),[]),p=function(){var e=pr((function*(e){const r=t.replaceTemplateVars(e),i=yield t.zabbix.getAllHosts(r);let o=null==i?void 0:i.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Nt()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:d,value:m},h]=Ot(pr((function*(){return yield p(e.group.filter)})),[e.group.filter]),g=function(){var e=pr((function*(e,r){const i=t.replaceTemplateVars(e),o=t.replaceTemplateVars(r),a=yield t.zabbix.getAllMacros(i,o);let s=null==a?void 0:a.map((e=>({value:e.macro,label:e.macro})));return s=n().uniqBy(s,(e=>e.value)),s.unshift({value:"/.*/"}),s.unshift(...Nt()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:f,value:v},y]=Ot(pr((function*(){return yield g(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),b=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),E=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter);(0,wt.useEffect)((()=>{c()}),[]),(0,wt.useEffect)((()=>{h()}),[b]),(0,wt.useEffect)((()=>{y()}),[b,E]);const I=t=>n=>{var i,o;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){dr(e,t,n[t])}))}return e}({},e),o=null!=(o={[t]:{filter:n}})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})),i))};return Tt().createElement(Tt().Fragment,null,Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Group",labelWidth:12},Tt().createElement($t,{width:24,value:e.group.filter,options:u,isLoading:l,onChange:I("group")})),Tt().createElement(St.InlineField,{label:"Host",labelWidth:12},Tt().createElement($t,{width:24,value:e.host.filter,options:m,isLoading:d,onChange:I("host")}))),Tt().createElement(Pt,null,Tt().createElement(St.InlineField,{label:"Macros",labelWidth:12},Tt().createElement($t,{width:24,value:e.macro.filter,options:v,isLoading:f,onChange:I("macro")}))))};function hr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hr(e,t,n[t])}))}return e}function fr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const vr=[{value:u,label:"Metrics",description:"Query numeric metrics"},{value:p,label:"Text",description:"Query text data"},{value:c,label:"Services",description:"Query services SLA"},{value:d,label:"Item Id",description:"Query metrics by item ids"},{value:m,label:"Triggers",description:"Count triggers"},{value:h,label:"Problems",description:"Query problems"},{value:v,label:"User macros",description:"User Macros"}];function yr(){return yr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},yr.apply(this,arguments)}var br;const Er=(null===(br=St.LegacyForms)||void 0===br?void 0:br.Input)||St.Input,Ir=RegExp(`^${/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g.source}`),wr=e=>({inputRegex:At.css`
    color: ${e.colors.warning.main};
  `,inputVariable:At.css`
    color: ${e.colors.action.focus};
  `}),Tr={[St.EventsWithValidation.onBlur]:[{rule:e=>!e||!(e.length>1&&"/"===e[0]&&"/"!==e[e.length-1]),errorMessage:"Not a valid regex"},{rule:e=>"*"!==e,errorMessage:"Wildcards not supported. Use /.*/ instead"}]},xr=e=>{var{value:t,ref:n,validationEvents:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["value","ref","validationEvents"]);const o=(0,St.useStyles2)(wr);let a=o.inputRegex;return Ir.test(t)?a=o.inputVariable:C(t)&&(a=o.inputRegex),Tt().createElement(Er,yr({className:a,value:t,validationEvents:Tr},i))};function Or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Or(e,t,n[t])}))}return e}function Pr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class Ar extends wt.PureComponent{getSelectedQueryType(e){return this.queryTypes.find((t=>t.value===e))}render(){var e;const{selectedQueryType:t,legacyQuery:n,group:r,host:i,application:o,itemTag:a,item:s}=this.state,{datasource:l}=this.props,u=(null==l||null===(e=l.zabbix)||void 0===e?void 0:e.isZabbix54OrHigherSync())||!1;return Tt().createElement(Tt().Fragment,null,Tt().createElement("div",{className:"gf-form max-width-21"},Tt().createElement(St.InlineFormLabel,{width:10},"Query Type"),Tt().createElement(St.Select,{width:11,value:t,options:this.queryTypes,onChange:this.handleQueryTypeChange})),Tt().createElement("div",{className:"gf-form-inline"},Tt().createElement("div",{className:"gf-form max-width-30"},Tt().createElement(St.InlineFormLabel,{width:10},"Group"),Tt().createElement(xr,{value:r,onChange:e=>this.handleQueryUpdate(e,"group"),onBlur:this.handleQueryChange})),t.value!==E.Group&&Tt().createElement("div",{className:"gf-form max-width-30"},Tt().createElement(St.InlineFormLabel,{width:10},"Host"),Tt().createElement(xr,{value:i,onChange:e=>this.handleQueryUpdate(e,"host"),onBlur:this.handleQueryChange}))),(t.value===E.Application||t.value===E.ItemTag||t.value===E.Item||t.value===E.ItemValues)&&Tt().createElement("div",{className:"gf-form-inline"},u&&Tt().createElement("div",{className:"gf-form max-width-30"},Tt().createElement(St.InlineFormLabel,{width:10},"Item tag"),Tt().createElement(xr,{value:a,onChange:e=>this.handleQueryUpdate(e,"itemTag"),onBlur:this.handleQueryChange})),!u&&Tt().createElement("div",{className:"gf-form max-width-30"},Tt().createElement(St.InlineFormLabel,{width:10},"Application"),Tt().createElement(xr,{value:o,onChange:e=>this.handleQueryUpdate(e,"application"),onBlur:this.handleQueryChange})),(t.value===E.Item||t.value===E.ItemValues)&&Tt().createElement("div",{className:"gf-form max-width-30"},Tt().createElement(St.InlineFormLabel,{width:10},"Item"),Tt().createElement(xr,{value:s,onChange:e=>this.handleQueryUpdate(e,"item"),onBlur:this.handleQueryChange}))),n&&Tt().createElement("div",{className:"gf-form"},Tt().createElement(St.InlineFormLabel,{width:10,tooltip:"Original query string, read-only"},"Legacy Query"),Tt().createElement(St.Input,{value:n,readOnly:!0})))}constructor(e){if(super(e),this.queryTypes=[{value:E.Group,label:"Group"},{value:E.Host,label:"Host"},{value:E.Application,label:"Application"},{value:E.ItemTag,label:"Item tag"},{value:E.Item,label:"Item"},{value:E.ItemValues,label:"Item values"}],this.defaults={selectedQueryType:{value:E.Group,label:"Group"},queryType:E.Group,group:"/.*/",host:"",application:"",itemTag:"",item:""},this.handleQueryUpdate=(e,t)=>{const n=e.currentTarget.value;this.setState((e=>{const r=Sr({},e);return r[t]=n,Sr({},r)}))},this.handleQueryChange=()=>{const{queryType:e,group:t,host:n,application:r,itemTag:i,item:o}=this.state,a={queryType:e,group:t,host:n,application:r,itemTag:i,item:o};this.props.onChange(a,`Zabbix - ${e}`)},this.handleQueryTypeChange=e=>{this.setState(Pr(Sr({},this.state),{selectedQueryType:e,queryType:e.value}));const{group:t,host:n,application:r,itemTag:i,item:o}=this.state,a=e.value,s={queryType:a,group:t,host:n,application:r,itemTag:i,item:o};this.props.onChange(s,`Zabbix - ${a}`)},this.props.query&&"string"==typeof this.props.query){const e=A(this.props.query),t=this.getSelectedQueryType(e.queryType);this.state=Sr({selectedQueryType:t,legacyQuery:this.props.query},e)}else if(this.props.query){const e=this.props.query,t=this.getSelectedQueryType(e.queryType);this.state=Pr(Sr({},this.defaults,e),{selectedQueryType:t})}else this.state=this.defaults}}function Dr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Dr(e,t,n[t])}))}return e}function Rr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{FormField:Fr,Switch:$r}=St.LegacyForms,jr=["mysql","postgres","influxdb"],Nr=[{label:"User and password",value:w.UserLogin},{label:"API token",value:w.Token}],kr=(e,t,n)=>r=>{n(Rr(Cr({},t),{jsonData:Rr(Cr({},t.jsonData),{[e]:r.currentTarget.value})}))},Lr=(e,t,n)=>r=>{n(Rr(Cr({},t),{jsonData:Rr(Cr({},t.jsonData),{[e]:r.target.checked})}))},_r=(e,t,n)=>r=>{n(Rr(Cr({},t),{secureJsonData:Rr(Cr({},t.secureJsonData),{[e]:r.currentTarget.value})}))},Mr=(e,t,n)=>r=>{n(Rr(Cr({},t),{secureJsonFields:Rr(Cr({},t.secureJsonFields),{[e]:!1})}))},Vr=(e,t,n,r)=>i=>{const o=qr().find((e=>e.id===i.value));n({label:o.name,value:o.id}),r(o.type),t(Rr(Cr({},e),{jsonData:Rr(Cr({},e.jsonData),{dbConnectionDatasourceId:i.value})}))},qr=()=>{let e=(0,re.getDataSourceSrv)().getAll();return e=e.filter((e=>jr.includes(e.type))),e},Br=new e.DataSourcePlugin(Qt).setConfigEditor((e=>{var t,n,r,i,o;const{options:a,onOptionsChange:s}=e,[l,u]=(0,wt.useState)(null),[c,p]=(0,wt.useState)("");return(0,wt.useEffect)((()=>{const{jsonData:e,secureJsonFields:t}=a,{password:n}=e,r=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["password"]);if((null==t?void 0:t.password)||(a.secureJsonData||(a.secureJsonData={}),a.secureJsonData.password=n),s(Rr(Cr({},a),{jsonData:Cr({authType:w.UserLogin,trends:!0,trendsFrom:"",trendsRange:"",cacheTTL:"",timeout:void 0,disableDataAlignment:!1},r)})),a.jsonData.dbConnectionEnable)if(a.jsonData.dbConnectionDatasourceId){const e=qr().find((e=>e.id===a.jsonData.dbConnectionDatasourceId));u({label:null==e?void 0:e.name,value:null==e?void 0:e.id}),p(null==e?void 0:e.type)}else{const e=a.jsonData.dbConnectionDatasourceName;(0,re.getDataSourceSrv)().get(e).then((e=>{if(e){const t=qr().find((t=>t.id===e.id));u({label:null==t?void 0:t.name,value:null==t?void 0:t.id}),p(null==t?void 0:t.type),s(Rr(Cr({},a),{jsonData:Rr(Cr({},a.jsonData),{dbConnectionDatasourceId:e.id})}))}}))}}),[]),Tt().createElement(Tt().Fragment,null,Tt().createElement(St.DataSourceHttpSettings,{defaultUrl:"http://localhost/zabbix/api_jsonrpc.php",dataSourceConfig:a,showAccessOptions:!0,onChange:s}),Tt().createElement("div",{className:"gf-form-group"},Tt().createElement("h3",{className:"page-heading"},"Zabbix API details"),Tt().createElement("div",{className:"gf-form"},Tt().createElement(St.InlineFormLabel,{width:7,tooltip:"Token authentication available in Zabbix version 5.4 and higher."},"Auth type"),Tt().createElement(St.Select,{width:30,options:Nr,value:a.jsonData.authType,onChange:(d="authType",m=a,h=s,e=>{h(Rr(Cr({},m),{jsonData:Rr(Cr({},m.jsonData),{[d]:e.value})}))})})),(null===(t=a.jsonData)||void 0===t?void 0:t.authType)===w.Token?Tt().createElement(Tt().Fragment,null,Tt().createElement("div",{className:"gf-form max-width-25"},(null===(n=a.secureJsonFields)||void 0===n?void 0:n.apiToken)?Tt().createElement(Tt().Fragment,null,Tt().createElement(Fr,{labelWidth:7,inputWidth:15,label:"API token",disabled:!0,value:"",placeholder:"Configured"}),Tt().createElement(St.Button,{onClick:Mr("apiToken",a,s)},"Reset")):Tt().createElement(Fr,{labelWidth:7,inputWidth:15,label:"API token",type:"password",value:(null===(r=a.secureJsonData)||void 0===r?void 0:r.apiToken)||"",onChange:_r("apiToken",a,s),required:!0}))):Tt().createElement(Tt().Fragment,null,Tt().createElement("div",{className:"gf-form max-width-25"},Tt().createElement(Fr,{labelWidth:7,inputWidth:15,label:"Username",value:a.jsonData.username||"",onChange:kr("username",a,s),required:!0})),Tt().createElement("div",{className:"gf-form max-width-25"},(null===(i=a.secureJsonFields)||void 0===i?void 0:i.password)?Tt().createElement(Tt().Fragment,null,Tt().createElement(Fr,{labelWidth:7,inputWidth:15,label:"Password",disabled:!0,value:"",placeholder:"Configured"}),Tt().createElement(St.Button,{onClick:Mr("password",a,s)},"Reset")):Tt().createElement(Fr,{labelWidth:7,inputWidth:15,label:"Password",type:"password",value:(null===(o=a.secureJsonData)||void 0===o?void 0:o.password)||a.jsonData.password||"",onChange:_r("password",a,s),required:!0}))),Tt().createElement($r,{label:"Trends",labelClass:"width-7",checked:a.jsonData.trends,onChange:Lr("trends",a,s)}),a.jsonData.trends&&Tt().createElement(Tt().Fragment,null,Tt().createElement("div",{className:"gf-form"},Tt().createElement(Fr,{labelWidth:7,inputWidth:4,label:"After",value:a.jsonData.trendsFrom||"",placeholder:"7d",onChange:kr("trendsFrom",a,s),tooltip:"Time after which trends will be used. Best practice is to set this value to your history storage period (7d, 30d, etc)."})),Tt().createElement("div",{className:"gf-form"},Tt().createElement(Fr,{labelWidth:7,inputWidth:4,label:"Range",value:a.jsonData.trendsRange||"",placeholder:"4d",onChange:kr("trendsRange",a,s),tooltip:"Time range width after which trends will be used instead of history. It's better to set this value in range of 4 to 7 days to prevent loading large amount of history data."}))),Tt().createElement("div",{className:"gf-form"},Tt().createElement(Fr,{labelWidth:7,inputWidth:4,label:"Cache TTL",value:a.jsonData.cacheTTL||"",placeholder:"1h",onChange:kr("cacheTTL",a,s),tooltip:"Zabbix data source caches metric names in memory. Specify how often data will be updated."})),Tt().createElement("div",{className:"gf-form"},Tt().createElement(Fr,{labelWidth:7,inputWidth:4,type:"number",label:"Timeout",value:a.jsonData.timeout,onChange:e=>{s(Rr(Cr({},a),{jsonData:Rr(Cr({},a.jsonData),{timeout:parseInt(e.currentTarget.value,10)})}))},tooltip:"Zabbix API connection timeout in seconds. Default is 30."}))),Tt().createElement("div",{className:"gf-form-group"},Tt().createElement("h3",{className:"page-heading"},"Direct DB Connection"),Tt().createElement($r,{label:"Enable",labelClass:"width-9",checked:a.jsonData.dbConnectionEnable,onChange:Lr("dbConnectionEnable",a,s)}),a.jsonData.dbConnectionEnable&&Tt().createElement(Tt().Fragment,null,Tt().createElement("div",{className:"gf-form"},Tt().createElement(St.InlineFormLabel,{width:9},"Data Source"),Tt().createElement(St.Select,{width:32,options:qr().map((e=>({label:e.name,value:e.id,description:e.type}))),value:l,onChange:Vr(a,s,u,p)})),"influxdb"===c&&Tt().createElement("div",{className:"gf-form"},Tt().createElement(Fr,{labelWidth:9,inputWidth:16,label:"Retention Policy",value:a.jsonData.dbConnectionRetentionPolicy||"",placeholder:"Retention policy name",onChange:kr("dbConnectionRetentionPolicy",a,s),tooltip:"Specify retention policy name for fetching long-term stored data (optional). Leave it blank if only default retention policy used."})))),Tt().createElement("div",{className:"gf-form-group"},Tt().createElement("h3",{className:"page-heading"},"Other"),Tt().createElement($r,{label:"Disable acknowledges for read-only users",labelClass:"width-20",checked:a.jsonData.disableReadOnlyUsersAck,onChange:Lr("disableReadOnlyUsersAck",a,s)}),Tt().createElement($r,{label:"Disable data alignment",labelClass:"width-20",checked:!!a.jsonData.disableDataAlignment,onChange:Lr("disableDataAlignment",a,s),tooltip:"Data alignment feature aligns points based on item update interval. For instance, if value collected once per minute, then timestamp of the each point will be set to the start of corresponding minute. This alignment required for proper work of the stacked graphs. If you don't need stacked graphs and want to get exactly the same timestamps as in Zabbix, then you can disable this feature."})),re.config.featureToggles.secureSocksDSProxyEnabled&&(0,Ve.gte)(re.config.buildInfo.version,"10.0.0-0")&&Tt().createElement("div",{className:"gf-form-group"},Tt().createElement($r,{label:"Secure Socks Proxy",labelClass:"width-20",checked:a.jsonData.enableSecureSocksProxy,tooltip:"Enable proxying the datasource connection through the secure socks proxy to a different network.",onChange:Lr("enableSecureSocksProxy",a,s)})));var d,m,h})).setQueryEditor((({query:e,datasource:t,onChange:n,onRunQuery:r})=>{const i={schema:12,queryType:u,group:{filter:""},host:{filter:""},application:{filter:""},itemTag:{filter:""},item:{filter:""},macro:{filter:""},functions:[],trigger:{filter:""},countTriggersBy:"",tags:{filter:""},proxy:{filter:""},textFilter:"",evaltype:T.AndOr,options:{showDisabledItems:!1,skipEmptyValues:!1,disableDataAlignment:!1,useZabbixValueMapping:!1,useTrends:"default",count:!1},table:{skipEmptyValues:!1}};(e=gr({},i,e)).options=gr({},i.options,e.options);const{queryType:o}=e;if(o===h||o===m){const t={showProblems:I.Problems,options:{minSeverity:0,sortProblems:"default",acknowledged:2,hostsInMaintenance:!1,hostProxy:!1,limit:1001,useTimeRange:!1,count:!1}};(e=gr({},t,e)).options=gr({},t.options,e.options)}o===c&&(e=gr({},{itServiceFilter:"",slaFilter:"",slaProperty:"sla",slaInterval:"none"},e)),(0,wt.useEffect)((()=>{const t=Q(e);n(t)}),[]);const a=e=>{n(e),r()};return Tt().createElement(Tt().Fragment,null,Tt().createElement(St.InlineFieldRow,null,Tt().createElement(St.InlineField,{label:"Query type",labelWidth:12},Tt().createElement(St.Select,{isSearchable:!1,width:24,value:o,options:vr,onChange:("queryType",t=>{null!==t.value&&a(fr(gr({},e),{queryType:t.value}))})})),Tt().createElement("div",{className:"gf-form gf-form--grow"},Tt().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),o===u&&Tt().createElement(Tt().Fragment,null,Tt().createElement(an,{query:e,datasource:t,onChange:a}),Tt().createElement(wn,{query:e,onChange:a})),o===d&&Tt().createElement(Tt().Fragment,null,Tt().createElement(Un,{query:e,onChange:a}),Tt().createElement(wn,{query:e,onChange:a})),o===p&&Tt().createElement(Tt().Fragment,null,Tt().createElement(kn,{query:e,datasource:t,onChange:a})),o===c&&Tt().createElement(Tt().Fragment,null,Tt().createElement(tr,{query:e,datasource:t,onChange:a}),Tt().createElement(wn,{query:e,onChange:a})),o===h&&Tt().createElement(Wn,{query:e,datasource:t,onChange:a}),o===m&&Tt().createElement(ur,{query:e,datasource:t,onChange:a}),o===v&&Tt().createElement(mr,{query:e,datasource:t,onChange:a}),Tt().createElement(Dn,{queryType:o,queryOptions:e.options,onChange:t=>{a(fr(gr({},e),{options:t}))}}))})).setVariableQueryEditor(Ar)})(),f})()));
//# sourceMappingURL=module.js.map